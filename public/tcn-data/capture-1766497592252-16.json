{
  "url": "https://os.ourvend.com/SaleMonitor/Index",
  "status": 200,
  "contentType": "text/html; charset=utf-8",
  "body": "\r\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n    <meta charset=\"utf-8\">\r\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\r\n    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no\" />\r\n    <title></title>\r\n    <link href=\"../../Content/style.min.css\" rel=\"stylesheet\" />\r\n    <link href=\"../../Content/animate.min.css\" rel=\"stylesheet\" />\r\n    <link type=\"text/css\" href=\"../../Content/bootstrap/css/bootstrap.min.css\" rel=\"Stylesheet\" />\r\n    <link type=\"text/css\" href=\"../../Content/jqGridBootstrap/css/ui.jqgrid-bootstrap.css\" rel=\"Stylesheet\" />\r\n    <link href=\"../../Content/layer/skin/layer.css\" rel=\"stylesheet\" />\r\n    <style>\r\n        .font-weight {\r\n            font-weight: normal;\r\n        }\r\n\r\n        .ui-jqgrid-hbox {\r\n            padding-right: 0px !important;\r\n        }\r\n    </style>\r\n    <script type=\"text/javascript\" src=\"../../Content/bootstrap/js/jquery-1.9.1.js\"></script>\r\n    <script type=\"text/javascript\" src=\"../../Content/bootstrap/js/bootstrap.min.js\"></script>\r\n    <script type=\"text/javascript\" src=\"../../Content/jqGridBootstrap/js/i18n/grid.locale-en.js\"></script>\r\n    <script type=\"text/javascript\" src=\"../../Content/jqGridBootstrap/js/jquery.jqGrid.min.js\"></script>\r\n    <script src=\"../../Content/layer/layer.js\"></script>\r\n    <script type=\"text/javascript\">\r\n        var i = 0;\r\n        var myDate = new Date();\r\n        //获取当前年\r\n        var year = myDate.getFullYear();\r\n        //获取当前月\r\n        var month = myDate.getMonth() + 1;\r\n        //获取当前日\r\n        var day = myDate.getDate();\r\n        var Time = year + \"-\" + month + \"-\" + day;\r\n\r\n        var Mid = \"\";\r\n        function SetupGrid(grid, pager) {\r\n            grid.jqGrid({\r\n                url: '/SaleMonitor/ListJson',\r\n                styleUI: \"Bootstrap\",\r\n                datatype: 'json',\r\n                mtype: \"post\",\r\n                colNames: [\"MsID\", \"Machine ID\", \"Machine name \", \"Machine body ID\", \"Network status\", \"Temperature\", \"Sales amount\", \"Sales quantity\", \"Amount of change consumed\", \"Amount under failed give-out\", \"Quantity under failed give-out\", \"Amount of  payments\", \"Change amount\", \"Amount of cash payment\", \"Amount of coin payment\", \"Amount of paper money change\", \"Current coin amount\", \"Time\", \"Deployment address\", \"Administrator\"],\r\n         \r\n                colModel: [\r\n                    { name: 'MId', index: 'MId', width: 1, hidden: true, key: true },\r\n                    { name: 'MId', index: 'MId', align: 'center', width: 100, sortable: true, hidden: false, frozen: true },\r\n                    { name: 'MiAlias', index: 'MiAlias', align: 'center', width: 120, sortable: true, hidden: false, frozen: true },\r\n                    { name: 'BoxId', index: 'BoxId', align: 'center', width: 120, sortable: false, hidden: false, frozen: true },\r\n                    { name: 'MiNoline', index: 'MiNoline', align: 'center', width: 80, sortable: true, hidden: false, formatter: alarmFormatter },\r\n                    { name: 'MiInsideTemp', index: 'MiInsideTemp', width: 60, align: 'center', sortable: true, hidden: false, formatter: ActionFormatter1 },\r\n                    { name: 'SaleAmount', index: 'SaleAmount', width: 80, align: 'center', sortable: true, hidden: false, formatter: ActionFormatter2 },\r\n                    { name: 'SaleQuantity', index: 'SaleQuantity', width: 60, align: 'center', sortable: true, hidden: false },\r\n                    { name: 'ChangeConsume', index: 'ChangeConsume', width: 60, align: 'center', sortable: true, hidden: false, formatter: ActionFormatter1 },\r\n                    { name: 'FailAmount', index: 'FailAmount', width: 80, align: 'center', sortable: true, hidden: false, formatter: ActionFormatter2 },\r\n                    { name: 'FailQuantity', index: 'FailQuantity', width: 80, align: 'center', sortable: true, hidden: false, formatter: ActionFormatter1 },\r\n                    { name: 'Collect', index: 'Collect', width: 80, align: 'center', sortable: true, hidden: false, formatter: ActionFormatter1 },\r\n                    { name: 'Change', index: 'Change', align: 'center', width: 80, sortable: true, hidden: false, formatter: ActionFormatter1 },\r\n                    { name: 'NoteAmount', index: 'NoteAmount', width: 80, align: 'center', sortable: true, hidden: false, formatter: ActionFormatter2 },\r\n                    { name: 'CoinAmount', index: 'CoinAmount', width: 80, align: 'center', sortable: true, hidden: false, formatter: ActionFormatter2 },\r\n                    { name: 'CurrentNote', index: 'CurrentNote', width: 80, align: 'center', sortable: true, hidden: false, formatter: ActionFormatter1 },\r\n                    { name: 'NowCoinValue', index: 'NowCoinValue', width: 80, align: 'center', sortable: true, hidden: false, formatter: ActionFormatter1 },\r\n                    { name: 'MsiTime', index: 'MsiTime', width: 150, align: 'center', sortable: true, formatter: 'date', formatoptions: { newformat: 'Y-m-d H:i:s' } },\r\n                    { name: 'MiAddress', index: 'MiAddress', width: 150, align: 'center', sortable: true, hidden: false },\r\n                    { name: 'MgName', index: 'MgName', width: 80, align: 'center', sortable: true, hidden: false }\r\n                ],\r\n                sortname: 'MId',\r\n                sortorder: \"desc\",\r\n                multiselect: false,\r\n                multiboxonly: false,\r\n                width: $(this).parent().width(),\r\n                rowNum: 10,\r\n                rowList: [10, 20, 50, 100, 200, 500],\r\n                height: 350,\r\n                autowidth: true,\r\n                pager: '#pager',\r\n                rownumbers: true,\r\n                shrinkToFit: false,\r\n                ondblClickRow: function (id) {\r\n                    if (id != null && id != \"\") {\r\n                        Mid = id;\r\n                        ShowEditor(id);\r\n\r\n                    }\r\n                }\r\n\r\n\r\n            });\r\n        }\r\n        /********************************************/\r\n        function SetupAmountGrid(grid, pager) {\r\n            grid.jqGrid({\r\n                url: '/SaleDetail/AmountListJson',\r\n                styleUI: \"Bootstrap\",\r\n                datatype: 'json',\r\n                mtype: \"post\",\r\n                postData: { \"MiGroup\": $(\"#MiGroup\").val(), \"MachineID\": $(\"#MachineID\").val(), \"boxId\": $(\"#boxId\").val() },\r\n                colNames: [\"Payment type\", \"Sales amount\", \"Sales quantity\", \"Amount under failed give-out\", \"Quantity under failed give-out\", \"Amount of  payments\", \"Change amount\"],\r\n                colModel: [\r\n                    { name: 'PayID', index: 'PayID', align: 'center', sortable: true, hidden: false, frozen: true, formatter: TrPayType },\r\n                    { name: 'TotalAmount', index: 'TotalAmount', align: 'center', sortable: true, hidden: false, frozen: true, formatter: ActionFormatter1 },\r\n                    { name: 'TotalCount', index: 'TotalCount', align: 'center', sortable: true, hidden: false, frozen: true },\r\n                    { name: 'TrAmount', index: 'TrAmount', align: 'center', sortable: true, hidden: false, frozen: true, formatter: ActionFormatter1 },\r\n                    { name: 'TrCount', index: 'TrCount', align: 'center', sortable: true, hidden: false, frozen: true },\r\n                    { name: 'Collect', index: 'Collect', align: 'center', sortable: true, hidden: false, frozen: true },\r\n                    { name: 'Change', index: 'Change', align: 'center', sortable: true, hidden: false, frozen: true },\r\n                ],\r\n                sortname: 'PayID',\r\n                sortorder: \"asc\",\r\n                multiselect: false,\r\n                multiboxonly: false,\r\n                width: document.body.clientWidth - 50,\r\n                rownumbers: true,\r\n                caption: '',\r\n                height: window.screen.height * 0.19,\r\n                caption: \"Payment method\",\r\n                shrinkToFit: false,\r\n                footerrow: true,\r\n                gridComplete: function () {\r\n                    var rowNum = parseInt($(this).getGridParam('records'), 10);\r\n                    if (rowNum > 0) {\r\n                        $(\".ui-jqgrid-sdiv\").show();\r\n                        var id = jQuery(this).getCol('PayID', false);\r\n                        var TotalAmount = jQuery(this).getCol('TotalAmount', false, 'sum').toFixed(2);\r\n                        var TotalCount = jQuery(this).getCol('TotalCount', false, 'sum');\r\n                        var TrAmount = jQuery(this).getCol('TrAmount', false, 'sum').toFixed(2);\r\n                        var TrCount = jQuery(this).getCol('TrCount', false, 'sum');\r\n                        var Collect = jQuery(this).getCol('Collect', false, 'sum').toFixed(2);\r\n                        var Change = jQuery(this).getCol('Change', false, 'sum').toFixed(2);\r\n\r\n                        $(this).footerData(\"set\", {\r\n                            PayID: \"Total\", TotalAmount: TotalAmount, TotalCount: TotalCount,\r\n                            TrAmount: TrAmount, TrCount: TrCount, Collect: Collect, Change: Change\r\n                        });\r\n                    } else {\r\n                        $(\".ui-jqgrid-sdiv\").hide();\r\n                    }\r\n                },\r\n                userDataOnFooter: true,\r\n            });\r\n        }\r\n\r\n        //自定义货机状态格式\r\n        function alarmFormatter(cellvalue, options, rowdata) {\r\n            if (cellvalue == \"1\") {\r\n                return '<img class=\"alarmimg\" src=\"../Content/images/1.png\" alt=\"' + cellvalue + '\" />';\r\n            }\r\n            else if (cellvalue == \"0\")\r\n                return '<img class=\"alarmimg\" src=\"../Content/images/2.png\" alt=\"' + cellvalue + '\" />';\r\n            else if (cellvalue == \"2\")\r\n                return '<img class=\"alarmimg\" src=\"../Content/images/x2.png\" alt=\"' + cellvalue + '\" />';\r\n            else if (cellvalue == \"3\")\r\n                return '<img class=\"alarmimg\" src=\"../Content/images/x3.png\" alt=\"' + cellvalue + '\" />';\r\n            else if (cellvalue == \"4\")\r\n                return '<img class=\"alarmimg\" src=\"../Content/images/1.png\" alt=\"' + cellvalue + '\" />';\r\n            else if (cellvalue == null)\r\n                return '';\r\n        }\r\n        //自定义货机故障格式\r\n        function IsFaultFormatter(cellvalue, options, rowdata) {\r\n            if (cellvalue == \"1\")\r\n                return 'Normal'; //正常\r\n            else if (cellvalue == \"4\")\r\n                return 'Error';\r\n            else if (cellvalue == null)\r\n                return '';\r\n        }\r\n        function addCellAttr(rowId, val, rawObject, cm, rdata) {\r\n            if (val == \"Error\")\r\n                return \"style='background-color:#FDFF72'\";\r\n            else if (val == \"Out of stock\")//缺货\r\n                return \"style='background-color:#FF784E'\";\r\n        }\r\n        function ActionFormatter2(num, options, rowObject) {\r\n            if (num == null) {\r\n                return 0;\r\n            } else {\r\n                num = num / 1;\r\n\r\n                return num.toFixed(2);\r\n            }\r\n        }\r\n        function ActionFormatter1(cellvalue, options, rowObject) {\r\n            var str = rowObject.SiID;\r\n            if (cellvalue == null || cellvalue == -100 || cellvalue == -9) {\r\n                cellvalue = '';\r\n            }\r\n            if (cellvalue != \"\" || cellvalue != '') {\r\n                cellvalue = Math.round(cellvalue * 100) / 100\r\n            }\r\n\r\n            return cellvalue;\r\n        }\r\n        var count = 0;\r\n        function ShowEditor(ID) {\r\n            $.post(\"/SaleMonitor/getSession\", \"\", function (data) {\r\n                if (data == \"True\") {\r\n                    loadmodel(ID);\r\n                    layer.open({\r\n                        type: 1,\r\n                        moveType: 1,\r\n                        area: [\"98%\", \"98%\"],\r\n                        content: $(\"#WatchDetail\"),\r\n                        title: \"Sales details\" + \"The time in the machine means the time when the machine dispensed the product; uploading time means the time when the data was uploaded to the machine. There can be a difference between these two times as the first ones can be inaccurate and there can be delays in the second ones.\",\r\n                        success: function () {\r\n                            if (count == 0) {\r\n                                SetupGridSI($(\"#gridIS\"));//交易流水\r\n                                SetupGridMR(ID);\r\n                                SetupGridPI($(\"#gridPI\"));//销售汇总\r\n                                SetupGridSaleInfo($(\"#gridSaleInfo\"));//出货记录\r\n                                SetupDoorStatusInfo($(\"#DoorStatusInfo\"));//门开关流水\r\n                                SetupReplenishmentInfo($(\"#ReplenishmentInfo\"));//补货记录\r\n                                AmountReceivable($(\"#AmountReceivable\")); //应收金额\r\n                            } else {\r\n                                $(\"#gridIS\").jqGrid('setGridParam', { datatype: 'json', postData: { MId: Mid, StartDate: Time, EndDate: Time } }).trigger(\"reloadGrid\");\r\n                                $(\"#gridPI\").jqGrid('setGridParam', { datatype: 'json', postData: { \"MId\": Mid, \"StartDate\": Time, \"EndDate\": Time } }).trigger(\"reloadGrid\");\r\n                                $(\"#gridSaleInfo\").jqGrid('setGridParam', { datatype: 'json', postData: { \"MId\": Mid, \"StartDate\": Time, \"EndDate\": Time } }).trigger(\"reloadGrid\");\r\n                                $(\"#DoorStatusInfo\").jqGrid('setGridParam', { datatype: 'json', postData: { \"MId\": Mid, \"StartDate\": Time, \"EndDate\": Time } }).trigger(\"reloadGrid\");\r\n                                $(\"#ReplenishmentInfo\").jqGrid('setGridParam', { datatype: 'json', postData: { \"MId\": Mid, \"StartDate\": Time, \"EndDate\": Time } }).trigger(\"reloadGrid\");\r\n                                $(\"#AmountReceivable\").jqGrid('setGridParam', { datatype: 'json', postData: { \"MId\": Mid, \"StartDate\": Time, \"EndDate\": Time } }).trigger(\"reloadGrid\");\r\n                            }\r\n                            count++;\r\n                        }\r\n                    });\r\n                } else {\r\n                    window.parent.getSessInfo();\r\n                }\r\n            });\r\n\r\n\r\n        }\r\n        //出货记录\r\n        function SetupGridSaleInfo(grid, pager) {\r\n            grid.jqGrid({\r\n                url: '/SaleMonitor/SaleInfoJson',\r\n                //colNames: ['TrID','货道号','支付方式','商品名称','单价', '出货结果','时间'], // \r\n                datatype: \"json\",\r\n                styleUI: \"Bootstrap\",\r\n                mtype: 'POST',\r\n                postData: { MId: Mid, StartDate: Time, EndDate: Time },\r\n                colNames: ['TrID', 'Slot', 'Payment type', 'Product name', 'Unit price', 'Result', 'Time', 'Server time'],\r\n                colModel: [\r\n                    { name: 'TrID', index: 'TrID', width: 1, hidden: true, key: true },\r\n                    { name: 'TrCoilID', index: 'TrCoilID', align: 'center', sortable: true, hidden: false, formatter: ActionFormatter1 },\r\n                    { name: 'TrPayType', index: 'TrPayType', align: 'center', sortable: true, hidden: false, formatter: TrPayType },\r\n                    { name: 'PrName', index: 'PrName', align: 'center', sortable: true, hidden: false, formatter: ActionFormatter1 },\r\n                    { name: 'TrSalePrice', index: 'TrSalePrice', align: 'center', sortable: true, hidden: false, formatter: ActionFormatter2 },\r\n                    { name: 'TrResult', index: 'TrResult', align: 'center', sortable: true, hidden: false, formatter: TrResult },\r\n                    { name: 'TrTime', index: 'TrTime', width: '150', align: 'center', sortable: true, formatter: 'date', formatoptions: { newformat: 'Y-m-d H:i:s' } },\r\n                    { name: 'AddTime', index: 'AddTime', width: '150', align: 'center', sortable: true, formatter: 'date', formatoptions: { newformat: 'Y-m-d H:i:s' } }\r\n                ],\r\n                shrinkToFit: false,\r\n                rownumbers: true,\r\n                sortname: 'TrID',\r\n                sortorder: \"asc\",\r\n                width: $(this).parent().width(),\r\n                caption: '',\r\n                height: 300, //200,\r\n                rowNum: 2000,\r\n            });\r\n        }\r\n        //销售汇总\r\n        function SetupGridPI(grid, pager) {\r\n            grid.jqGrid({\r\n                url: '/SaleMonitor/ProductSaleInfoJson',\r\n                datatype: \"json\",\r\n                styleUI: \"Bootstrap\",\r\n                mtype: 'POST',\r\n                postData: { MId: Mid, StartDate: Time, EndDate: Time },\r\n                colNames: ['TrBarCode', 'Product name', 'Sales amount', 'Sales quantity'], // \r\n                colModel: [\r\n                    { name: 'TrBarCode', index: 'TrBarCode', width: 1, hidden: true, key: true },\r\n                    { name: 'PrName', index: 'PrName', align: 'center', sortable: true, hidden: false },\r\n                    { name: 'SaleAmonut', index: 'SaleAmonut', align: 'center', sortable: true, hidden: false, formatter: ActionFormatter2 },\r\n                    { name: 'SaleNum', index: 'SaleNum', align: 'center', sortable: true, hidden: false },\r\n                ],\r\n                shrinkToFit: false,\r\n                sortname: 'TrBarCode',\r\n                sortorder: \"asc\",\r\n                rownumbers: true,\r\n                width: $(this).parent().width(),\r\n                caption: '',\r\n                height: 300, //200,\r\n                rowNum: 100,\r\n            });\r\n        }\r\n        //门开关流水\r\n        function SetupDoorStatusInfo(grid, pager) {\r\n            grid.jqGrid({\r\n                url: '/SaleMonitor/DoorStatusJson',\r\n                datatype: \"json\",\r\n                styleUI: \"Bootstrap\",\r\n                mtype: 'POST',\r\n                postData: { MId: Mid, StartDate: Time, EndDate: Time },\r\n                colNames: ['Machine ID', 'Machine name ', 'Status', 'Time'],\r\n                colModel: [\r\n                    { name: 'MachineID', index: 'MachineID', align: 'center', hidden: false, key: true },\r\n                    { name: 'MachineName', index: 'MachineName', align: 'center', sortable: true, hidden: false },\r\n                    {\r\n                        name: 'DoorStatus', index: 'DoorStatus', align: 'center', sortable: true, hidden: false, formatter: function (cellvalue, options, rowObject) {\r\n                            return cellvalue != 0 ? 'Open' : 'Close';\r\n                        }\r\n                    },\r\n                    { name: 'Time', index: 'Time', width: '150', align: 'center', sortable: true, formatter: 'date', formatoptions: { newformat: 'Y-m-d H:i:s' } }\r\n                ],\r\n                shrinkToFit: false,\r\n                sortname: 'Time',\r\n                sortorder: \"desc\",\r\n                rownumbers: true,\r\n                width: $(this).parent().width(),\r\n                caption: '',\r\n                height: 300, //200,\r\n                rowNum: 2000,\r\n            });\r\n        }\r\n        //补货记录\r\n        function SetupReplenishmentInfo(grid, pager) {\r\n            grid.jqGrid({\r\n                url: '/SaleMonitor/ReplenishmentJson',\r\n                datatype: \"json\",\r\n                styleUI: \"Bootstrap\",\r\n                mtype: 'POST',\r\n                postData: { MId: Mid, StartDate: Time, EndDate: Time },\r\n                colNames: ['MachineID', 'Product name', 'Quantity replenished', 'Time'],\r\n                colModel: [\r\n                    { name: 'MachineID', index: 'MachineID', align: 'center', hidden: true, key: true },\r\n                    {\r\n                        name: 'PrName', index: 'PrName', align: 'center', sortable: true, hidden: false, formatter: function (cellvalue, options, rowObject) {\r\n                            return cellvalue != null ? cellvalue : 'other';\r\n                        }\r\n                    },\r\n                    {\r\n                        name: 'Capacity', index: 'Capacity', align: 'center', sortable: true, hidden: false, formatter: function (cellvalue, options, rowObject) {\r\n                            return cellvalue != null ? cellvalue : 0;\r\n                        }\r\n                    },\r\n                    { name: 'Time', index: 'Time', width: '150', align: 'center', sortable: true, formatter: 'date', formatoptions: { newformat: 'Y-m-d' } }\r\n                ],\r\n                shrinkToFit: false,\r\n                sortname: 'Time',\r\n                sortorder: \"desc\",\r\n                rownumbers: true,\r\n                width: $(this).parent().width(),\r\n                caption: '',\r\n                height: 300, //200,\r\n                rowNum: 2000,\r\n            });\r\n        }\r\n\r\n        ///应收金额\r\n        function AmountReceivable(grid) {\r\n            grid.jqGrid({\r\n                url: '/SaleMonitor/AmountReceivable',\r\n                datatype: \"json\",\r\n                styleUI: \"Bootstrap\",\r\n                mtype: 'POST',\r\n                postData: { \"MId\": Mid, \"StartDate\": Time, \"EndDate\": Time },\r\n                colNames: ['MachineID', 'Amount receivable', 'Creation time', 'End time'],\r\n                colModel: [\r\n                    { name: 'MachineID', index: 'MachineID', align: 'center', hidden: true, key: true },\r\n                    { name: 'Amount', index: 'Amount', align: 'center', sortable: true, hidden: false, formatter: ActionFormatter2 },\r\n                    { name: 'StateTime', index: 'StateTime', align: 'center', sortable: true, hidden: false },\r\n                    { name: 'EndTime', index: 'EndTime', width: '150', align: 'center', sortable: true, hidden: false }\r\n                ],\r\n                shrinkToFit: false,\r\n                sortname: 'EndTime',\r\n                sortorder: \"desc\",\r\n                rownumbers: true,\r\n                width: $(this).parent().width(),\r\n                caption: 'Note: Each closing is used as a basis for cash receivable settlement. If the amount of receivable is 0 at the current closing, the settlement will not be accumulated until the next closing.',\r\n                height: 300, //200,\r\n                rowNum: 2000,\r\n            });\r\n        }\r\n        function ActionFormatter1SI(cellvalue, options, rowObject) {\r\n            var str = rowObject.SiID;\r\n            if (cellvalue == null) {\r\n                cellvalue = '';\r\n            }\r\n            var s = cellvalue;\r\n            return s;\r\n        }\r\n        function TrPayType(cellvalue, options, rowdata) {\r\n            var obj = parseInt(cellvalue)\r\n            console.log(obj)\r\n            switch (obj) {\r\n                case 0:\r\n                    return \"Pay by cash \"; //现金支付               \r\n                case 1:\r\n                    return \"UnionPay card\"; //银联支付             \r\n                case 2:\r\n                    return \"Membership card\"; //会员卡              \r\n                case 4:\r\n                    return \"Membership card\" //会员卡\r\n                case 5:\r\n                    return \"UnionPay card\" //银联支付\r\n                case 11:\r\n                    return \"WeChat payment\";//微信\r\n                case 12:\r\n                    return \"Alipay sound wave\";//支付宝声波付\r\n                case 13:\r\n                    return \"Alipay scan QR code\";//支付宝扫码\r\n                case 15:\r\n                    return \"Gift \"; //赠送\r\n                case 16:\r\n                    return \"One Key\";//一键出货\r\n                case 17:\r\n                    return \"Commodity taking code\";//提货码\r\n                case 65:\r\n                    return \"WeChat payment\" + \"(H)\";\r\n                case 66:\r\n                    return \"Alipay QR Pay\" + \"(H)\";\r\n                case 67:\r\n                    return \"JD.COM\" + \"(H)\";\r\n                case 68:\r\n                    return \"WeChat game\";\r\n                case 69:\r\n                    return \"Bestpay\";\r\n                case 70:\r\n                    return \"ICBC code scanning payment\";\r\n                case 71:\r\n                    return \"WeChat membership card\";\r\n                case 72:\r\n                    return \"Qpay\";\r\n                case 73:\r\n                    return \"Unionpay business\";\r\n                case 74:\r\n                    return \"PingAn E e-payment\";\r\n                case 75:\r\n                    return \"WeChat pay by face recognition\";\r\n                case 76:\r\n                    return \"Alipay face recognition payment\";\r\n                case 77:\r\n                    return \"Jd aggregate payment\";\r\n                case 79:\r\n                    return \"Lichu Payment\";\r\n                case 89:\r\n                    return \"AlipayNFC\";\r\n                case 90:\r\n                    return \"Hubtel Pay\";\r\n                case 92:\r\n                    return \"Midtrans Pay\";\r\n                case 93:\r\n                    return \"Paycools Pay\";\r\n                case 94:\r\n                    return \"KHQR Pay\";\r\n                case 101:\r\n                    return \"Remote Shipment\";\r\n                case 255:\r\n                    return \" Other Payments\";//其他支付\r\n                default:\r\n                    return cellvalue;\r\n            }\r\n        }\r\n        function TrResult(cellvalue, options, rowdata) {\r\n            if (cellvalue == \"0\")\r\n                return 'Normal'; //正常\r\n            else\r\n                return 'Error';\r\n        }\r\n        function PayTypeMr(cellvalue, options, rowdata) {\r\n            if (cellvalue == \"1\")\r\n                return 'Coin-operated'; //'投币'\r\n            else if (cellvalue == \"2\")\r\n                return 'Return coin'; //'退币'\r\n            else if (cellvalue == null)\r\n                return '';\r\n        }\r\n        function TypeMr(cellvalue, options, rowdata) {\r\n            if (cellvalue == \"1\")\r\n                return 'Note'; //'纸币'\r\n            else if (cellvalue == \"2\")\r\n                return 'Coin'; //'硬币'\r\n            else if (cellvalue == null)\r\n                return '';\r\n        }\r\n        function ActionFormatter1MR(cellvalue, options, rowObject) {\r\n            var str = rowObject.SiID;\r\n            if (cellvalue == null) {\r\n                cellvalue = '';\r\n            }\r\n            var s = cellvalue;\r\n            return s;\r\n        }\r\n        //交易流水Table[0]\r\n        function SetupGridSI(grid, pager) {\r\n\r\n            grid.jqGrid({\r\n                url: '/SaleMonitor/OutJson/',\r\n                datatype: \"json\",\r\n                styleUI: \"Bootstrap\",\r\n                mtype: 'POST',\r\n                postData: { MId: Mid, StartDate: Time, EndDate: Time },\r\n                colNames: ['ID', 'Slot', 'Product name', 'Payment type', 'Unit price', 'Result', 'Time', 'Server time'], //\r\n                colModel: [\r\n                    { name: 'TrID', index: 'TrID', width: 1, hidden: true, key: true },\r\n                    { name: 'TrCoilID', index: 'TrCoilID', align: 'center', width: \"80\", sortable: true, hidden: false, formatter: ActionFormatter1SI },\r\n                    { name: 'PrName', index: 'PrName', align: 'center', sortable: true, hidden: false, formatter: ActionFormatter1SI },\r\n                    { name: 'TrPayType', index: 'TrPayType', align: 'center', width: \"80\", sortable: true, hidden: false, formatter: TrPayType },\r\n                    { name: 'TrSalePrice', index: 'TrSalePrice', align: 'center', width: \"80\", sortable: true, hidden: false, formatter: ActionFormatter2 },\r\n                    { name: 'TrResult', index: 'TrResult', align: 'center', width: \"60\", sortable: true, hidden: false, formatter: TrResult },\r\n                    { name: 'TrTime', index: 'TrTime', width: '100', align: 'center', sortable: true, formatter: 'date', formatoptions: { newformat: 'm-d H:i:s' } },\r\n                    { name: 'AddTime', index: 'AddTime', width: '100', align: 'center', sortable: true, formatter: 'date', formatoptions: { newformat: 'm-d H:i:s' } }\r\n                ],\r\n                shrinkToFit: false,\r\n                rownumbers: true,\r\n                sortname: 'AddTime',\r\n                sortorder: \"desc\",\r\n                width: $(this).parent().width(),\r\n                caption: '',\r\n                height: 300, //200,'auto'\r\n                rowNum: 2000,\r\n                onCellSelect: function (id) {\r\n                    var data = $(\"#\" + id + \">td\");\r\n                    $(\"#gridMR\").jqGrid('setGridParam', { datatype: 'json', postData: { 'ID': id, \"Mid\": Mid, \"Time\": data[7].innerHTML } }).trigger(\"reloadGrid\");\r\n                }\r\n            });\r\n\r\n        }\r\n        function SetupGridMR(id) {\r\n            $(\"#gridMR\").jqGrid({\r\n                url: '/SaleMonitor/CashJson/',\r\n                datatype: \"json\",\r\n                styleUI: \"Bootstrap\",\r\n                mtype: 'POST',\r\n                postData: { \"ID\": id, \"Mid\": \"\" },\r\n                colNames: ['ID', 'Type', 'Payment types', 'Coin-operatedAmount', 'Amount to be refunded', 'Amount actually refunded ', 'Time'], // \r\n                colModel: [\r\n                    { name: 'MrID', index: 'MrID', width: 1, hidden: true, key: true },\r\n                    { name: 'MrPayType', index: 'MrPayType', width: '50', align: 'center', sortable: false, hidden: false, formatter: PayTypeMr },\r\n                    { name: 'MrType', index: 'MrType', width: '50', align: 'center', sortable: false, hidden: false, formatter: TypeMr },\r\n                    { name: 'MrBorrowMoney', index: 'MrBorrowMoney', width: '100', align: 'center', sortable: false, hidden: false, formatter: ActionFormatter2 },\r\n                    { name: 'MrLoanMoney', index: 'MrLoanMoney', width: '100', align: 'center', sortable: false, hidden: false, formatter: ActionFormatter2 },\r\n                    { name: 'RealPay', index: 'RealPay', width: '100', align: 'center', sortable: false, hidden: false, formatter: ActionFormatter1MR },\r\n                    { name: 'MrRecordTime', index: 'MrRecordTime', width: '150', align: 'center', sortable: true, formatter: 'date', formatoptions: { newformat: 'Y-m-d H:i:s' } },\r\n                ],\r\n                shrinkToFit: false,\r\n                sortname: 'MrID',\r\n                sortorder: \"asc\",\r\n                width: $(this).parent().width(),\r\n                caption: '',\r\n                height: 300,\r\n                rowNum: 2000\r\n            });\r\n        }\r\n\r\n\r\n        //加载销售明细\r\n        function loadmodel(id) {\r\n            $.post(\"/SaleMonitor/SaleInfo/\", { PrID: id, StartDate: $('#StartDate').val(), EndDate: $('#EndDate').val() }, function (data) {\r\n                $(\"#MachineIDs\").html(data[\"MId\"]);\r\n                $(\"#Aliase\").html(data[\"MiAlias\"]);\r\n                //$(\"#Receipt\").html(data[\"Collect\"]);\r\n                //$(\"#ChangeAmount\").html(data[\"Change\"]);\r\n                if (data[\"Collect\"] != null) {\r\n                    $(\"#Receipt\").html(parseFloat(data[\"Collect\"]).toFixed(2));\r\n                } else {\r\n                    $(\"#Receipt\").html(\"\");\r\n                }\r\n                if (data[\"Change\"] != null) {\r\n                    $(\"#ChangeAmount\").html(parseFloat(data[\"Change\"]).toFixed(2));\r\n                } else {\r\n                    $(\"#ChangeAmount\").html(\"\");\r\n                }\r\n                $(\"#Sale\").html(data[\"SaleAmount\"]);\r\n                $(\"#SaleQty\").html(data[\"SaleQuantity\"]);\r\n                $(\"#DeployAddress\").html(data[\"MiAddress\"]);\r\n\r\n            });\r\n        }\r\n        function Init() {\r\n            $.post(\"/SaleMonitor/getSession\", \"\", function (data) {\r\n                if (data == \"True\") {\r\n                    $(\"#btnSearch\").click(function () {\r\n                        Search();\r\n                    });\r\n                    $(\"#btnEdit\").click(function () {\r\n                        var s = GetSelectedItems();\r\n                        //alert(s);\r\n                        if (s != null) {\r\n                            Mid = s;\r\n                            ShowEditor(s);\r\n                        }\r\n                        else {\r\n                            alert(\"You must choose a record before operation Or double click a record\"); //选中一条记录才能进行操作！\r\n                        }\r\n                    });\r\n                    SetupGrid($(\"#grid\"));\r\n                    SetupAmountGrid($(\"#AmountGrid\"));\r\n                    $(\"#btnRefresh\").click(\r\n                        function () {\r\n                            RefreshAudit();\r\n                        });\r\n                } else {\r\n                    window.parent.getSessInfo();\r\n                }\r\n            });\r\n        }\r\n\r\n        function RefreshGrid() {\r\n            $(\"#grid\").trigger(\"reloadGrid\");\r\n        }\r\n\r\n        function Search() {\r\n            $.post(\"/SaleMonitor/getSession\", \"\", function (data) {\r\n                if (data == \"True\") {\r\n                    $(\"#grid\").jqGrid('setGridParam', { page: 1, sortname: 'ID', sortorder: \"desc\", postData: { 'MiGroup': $('#MiGroup').val(), 'MachineID': $('#MachineID').val(), 'boxId': $(\"#boxId\").val() } });\r\n                    $(\"#AmountGrid\").jqGrid('setGridParam', { page: 1, sortname: 'TrPayType', sortorder: \"desc\", postData: { 'MiGroup': $('#MiGroup').val(), 'MachineID': $('#MachineID').val(), 'boxId': $(\"#boxId\").val() } });\r\n                    RefreshGrid();\r\n                    $(\"#AmountGrid\").trigger('reloadGrid');\r\n                } else {\r\n                    window.parent.getSessInfo();\r\n                }\r\n            });\r\n        }\r\n\r\n        function RefreshAudit() {\r\n            $.ajax({\r\n                url: '/MachineOverview/RefreshAudit/',\r\n                dataType: \"text\",\r\n                type: \"POST\",\r\n                data: \"\",\r\n                success: function (resp) { alert(resp); }\r\n            });\r\n        }\r\n\r\n        function GetSelectedItems() {\r\n            return $(\"#grid\").getGridParam('selrow');\r\n        }\r\n\r\n        $(document).ready(function () {\r\n            $(\"body\").height(window.screen.height * 0.81);\r\n            Init();\r\n        });\r\n    </script>\r\n    <style type=\"text/css\">\r\n        .tab-content table {\r\n            width: 100% !important;\r\n        }\r\n\r\n        ::-webkit-scrollbar {\r\n            width: 8px;\r\n            height: 8px;\r\n        }\r\n        /*搜索栏*/\r\n        .ibox-title {\r\n            min-height: initial;\r\n            padding: 10px 12px;\r\n            background: #f9f9f9;\r\n        }\r\n\r\n            .ibox-title:after {\r\n                content: \"\";\r\n                display: block;\r\n                clear: both;\r\n                height: 0;\r\n                visibility: hidden;\r\n            }\r\n\r\n            .ibox-title h5 {\r\n                margin: 0;\r\n            }\r\n\r\n        .ibox-content:after {\r\n            content: \"\";\r\n            display: block;\r\n            clear: both;\r\n            height: 0;\r\n            visibility: hidden;\r\n        }\r\n\r\n        .ibox-content {\r\n            padding: 15px 20px 0 10px;\r\n        }\r\n\r\n            .ibox-content .group-left {\r\n                margin-bottom: 15px;\r\n            }\r\n\r\n        .float-e-margins .btn {\r\n            margin-bottom: 0px;\r\n        }\r\n\r\n        .ibox-content div.input-btton {\r\n            float: right;\r\n            margin-bottom: 15px;\r\n            height: auto;\r\n        }\r\n\r\n        .ibox-content .input-group.group-left label {\r\n            margin-left: 10px;\r\n            margin-top: 8px;\r\n            vertical-align: top;\r\n        }\r\n    </style>\r\n</head>\r\n<body class=\"fixed-sidebar full-height-layout pace-done\">\r\n    <div class=\"col-xs-12 col-md-12\" style=\"background-color: #f5f5f5; font-size: 14px;\">\r\n        <div class=\"col-xs-12 col-sm-12 col-md-6\" style=\"top: 4px;\"><span class=\"glyphicon glyphicon-home\">&nbspHome&nbsp</span>&gt<span>&nbspDaily operation monitoring&nbsp</span>&gt<span>&nbspDaily sale monitoring&nbsp</span></div>\r\n        <div class=\"col-xs-12 col-sm-12 col-md-6\" style=\"text-align: right;\"><a href=\"javascript:location.reload();\" class=\"btn btn-success btn\"><span class=\"glyphicon glyphicon-refresh\"></span></a></div>\r\n    </div>\r\n    <div style=\"height: 18px;\"></div>\r\n    <div class=\"wrapper wrapper-content animated fadeInRight\">\r\n        <div class=\"ibox float-e-margins bordercss\">\r\n            \r\n            <div class=\"ibox-content\">\r\n                \r\n<link href=\"../../Content/bootstrap/css/bootstrap-select.min.css\" rel=\"stylesheet\" />\r\n<script src=\"../../Content/bootstrap/js/bootstrap-select.min.js\"></script>\r\n<script type=\"text/javascript\">\r\n    $(document).ready(function () {\r\n        getGroup();\r\n        $(\"#MiGroup\").change(function () { getMachineID($(this).val()); });\r\n        $('#MiGroup,#MachineID').selectpicker({\r\n            width:140,\r\n            size: 4,\r\n        });\r\n        $('.selectpicker').selectpicker('refresh');\r\n        $(\"#MachineID\").on('shown.bs.select',\r\n            function (e) {\r\n                console.log('展开之后');\r\n                $('#MachineID').prev().find(\"input\").keyup(function () {\r\n                    document.getElementById(\"MachineID\").options.selectedIndex = 0; //回到初始状态\r\n                    $(\"#MachineID\").selectpicker('refresh');//对searchPayState这个下拉框进行重置刷新\r\n                    $('#MachineID').prev().find(\"input\").attr('id', \"deviceInput\"); //为input增加id属性\r\n                    console.log($('#deviceInput').val()); //获取输入框值输出到控制台\r\n                    deviceInput = $('#deviceInput').val()\r\n                    $('#MachineID').parent().find('button').children()[0].innerHTML = deviceInput\r\n                    //console.log(deviceInput)\r\n                })\r\n            })\r\n\r\n    });\r\n    //绑定组下拉框\r\n    function getGroup() {\r\n        $.ajax({\r\n            url: '/AssetsManage/GetStringMachineGroup',\r\n            type: \"post\",\r\n            datatype: \"json\",\r\n            success: function (data1) {\r\n                var Html = \"<option value=''>--Please choose--</option>\";\r\n                    var data = JSON.parse(data1);\r\n                    for (var i = 0; i < data.length; i++) {\r\n                        Html += \"<option value='\" + data[i].MGID + \"'>\" + data[i].MGName + \"</option>\";\r\n                    }\r\n                    $(\"#MiGroup\").html(Html);\r\n                $(\"#MiGroup\").selectpicker('refresh');\r\n                }\r\n        });\r\n    };\r\n    //获取机器IDselectpicker\r\n    function getMachineID(id) {\r\n        $.ajax({\r\n            url: '/SaleSummarize/GetMachineID',\r\n             type: \"post\",\r\n             datatype: \"json\",\r\n             data: { \"MachineGroup\": id },\r\n            success: function (data) {\r\n                console.log(data)\r\n                 var Html = \"<option value=''>--Please choose--</option>\";\r\n                    for (var i = 0; i < data.length; i++) {\r\n                        Html += \"<option value='\" + data[i].MuMachineID + \"'>\" + data[i].MiAlias + \"</option>\";\r\n                    }\r\n                    $(\"#MachineID\").html(Html);\r\n                $(\"#MachineID\").selectpicker('refresh');\r\n                //console.log($(\".MachineID\").prev().find('.bs-searchbox').find('input'))\r\n                }\r\n         });\r\n    }\r\n</script>\r\n<div class=\"input-group group-left\">\r\n    <label style=\"margin-top: 8px\">Machine grouping：</label>\r\n</div>\r\n<div class=\"input-group group-left\">\r\n    <div class=\"form-group\" style=\"margin-bottom:0px\">\r\n        <select class=\"selectpicker\" data-live-search=\"true\" data-size=\"10\" id=\"MiGroup\"></select>\r\n    </div>\r\n</div>\r\n<div class=\"input-group group-left\">\r\n    <label style=\"margin-left: 10px; margin-top: 8px\">Machine ID：</label>\r\n</div>\r\n<div class=\"input-group group-left\">\r\n    <div class=\"form-group\" style=\"margin-bottom:0px\">\r\n        <select class=\"selectpicker\" data-live-search=\"true\" data-size=\"10\" id=\"MachineID\">\r\n            <option value=''>--Please choose--</option>\r\n        </select>\r\n    </div>\r\n</div>\r\n\r\n                <div class=\"input-group group-left\">\r\n                    <label>Machine body ID</label>\r\n                    <div class=\"input-group-btn\"></div>\r\n                    <input type=\"text\" class=\"form-control\" id=\"boxId\" autocomplete=\"off\" />\r\n                </div>\r\n                <div class=\"input-btton\">\r\n\r\n                    <input id=\"btnEdit\" type=\"button\" style=\"margin-left: 20px\" class=\"btn btn-w-m btn-primary right\" value=\"Query details\" />\r\n                    <input id=\"btnSearch\" type=\"button\" style=\"margin-left: 20px\" class=\"btn btn-w-m btn-primary right\" value=\"Query\" />\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class=\"ibox float-e-margins bordercss\">\r\n            <div class=\"ibox-content\" style=\"padding: 0px\">\r\n                <table id=\"AmountGrid\">\r\n                </table>\r\n                <table id=\"grid\">\r\n                </table>\r\n                <div id=\"pager\">\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div id=\"WatchDetail\" style=\"display: none\">\r\n        <div class=\"ibox float-e-margins bordercss\">\r\n            <div class=\"ibox-content\" style=\"padding: 10px\">\r\n                <div class=\"row\">\r\n                    <div class=\"col-sm-3\">\r\n                        <label class=\"col-sm-6\">Machine ID</label>\r\n                        <label class=\"col-sm-6 font-weight\" id=\"MachineIDs\"></label>\r\n                        <input type=\"hidden\" id=\"Mid\" value=\"\" />\r\n                    </div>\r\n                    <div class=\"col-sm-3\">\r\n                        <label class=\"col-sm-6\">Machine name </label>\r\n                        <label class=\"col-sm-6 font-weight\" id=\"Aliase\"></label>\r\n                    </div>\r\n                    <div class=\"col-sm-3\">\r\n                        <label class=\"col-sm-6\">Amount of  payments</label>\r\n                        <label class=\"col-sm-6 font-weight\" id=\"Receipt\"></label>\r\n                    </div>\r\n                    <div class=\"col-sm-3\">\r\n                        <label class=\"col-sm-6\">Change amount</label>\r\n                        <label class=\"col-sm-6 font-weight\" id=\"ChangeAmount\"></label>\r\n                    </div>\r\n                </div>\r\n                <div class=\"row\">\r\n                    <div class=\"col-sm-3\">\r\n                        <label class=\"col-sm-6\">Sales amount</label>\r\n                        <label class=\"col-sm-6 font-weight\" id=\"Sale\"></label>\r\n                    </div>\r\n                    <div class=\"col-sm-3\">\r\n                        <label class=\"col-sm-6\">Sales quantity</label>\r\n                        <label class=\"col-sm-6 font-weight\" id=\"SaleQty\"></label>\r\n                    </div>\r\n                    <div class=\"col-sm-3\">\r\n                        <label class=\"col-sm-6\">Deployment address</label>\r\n                        <label class=\"col-sm-6 font-weight\" id=\"DeployAddress\"></label>\r\n                    </div>\r\n                    <div class=\"col-sm-3\">\r\n                        <label class=\"col-sm-6\">Administrator</label>\r\n                        <label class=\"col-sm-6 font-weight\" id=\"Controller\"></label>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class=\"tabs-container\" style=\"padding: 5px\">\r\n            <ul class=\"nav nav-tabs\">\r\n                <li class=\"active\"><a data-toggle=\"tab\" href=\"#tab-1\" aria-expanded=\"true\">Trading Flow</a>\r\n                </li>\r\n                <li class=\"\"><a data-toggle=\"tab\" href=\"#tab-2\" aria-expanded=\"false\">Sales summary</a>\r\n                </li>\r\n                <li class=\"\"><a data-toggle=\"tab\" href=\"#tab-3\" aria-expanded=\"false\">Card swiping record</a>\r\n                </li>\r\n                <li class=\"\"><a data-toggle=\"tab\" href=\"#tab-4\" aria-expanded=\"false\">Give-out record</a>\r\n                </li>\r\n                <li class=\"\"><a data-toggle=\"tab\" href=\"#tab-5\" aria-expanded=\"false\">Door opening/closing record</a></li>\r\n                <li class=\"\"><a data-toggle=\"tab\" href=\"#tab-6\" aria-expanded=\"false\">Replenishment record</a></li>\r\n                <li class=\"\"><a data-toggle=\"tab\" href=\"#tab-7\" aria-expanded=\"false\">Amount receivable</a></li>\r\n            </ul>\r\n            <div class=\"tab-content\">\r\n                <div id=\"tab-1\" class=\"tab-pane active\">\r\n                    <div class=\"panel-body\" style=\"padding: 10px 0px 10px 0px\">\r\n                        <div class=\"col-sm-6\">\r\n                            <table id=\"gridIS\">\r\n                            </table>\r\n                        </div>\r\n                        <div class=\"col-sm-6\">\r\n                            <table id=\"gridMR\">\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div id=\"tab-2\" class=\"tab-pane\">\r\n                    <div class=\"panel-body\" style=\"padding: 10px 0px 10px 0px\">\r\n                        <div class=\"col-sm-12\">\r\n                            <table id=\"gridPI\">\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div id=\"tab-3\" class=\"tab-pane\">\r\n                    <div class=\"panel-body\" style=\"height: 350px; padding: 10px 0px 10px 0px\">\r\n                        <strong>No Data</strong>\r\n                        <p></p>\r\n                    </div>\r\n                </div>\r\n                <div id=\"tab-4\" class=\"tab-pane\">\r\n                    <div class=\"panel-body\" style=\"padding: 10px 0px 10px 0px\">\r\n                        <div class=\"col-sm-12\">\r\n                            <table id=\"gridSaleInfo\">\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div id=\"tab-5\" class=\"tab-pane\">\r\n                    <div class=\"panel-body\" style=\"padding: 10px 0px 10px 0px\">\r\n                        <div class=\"col-sm-12\">\r\n                            <table id=\"DoorStatusInfo\">\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div id=\"tab-6\" class=\"tab-pane\">\r\n                    <div class=\"panel-body\" style=\"padding: 10px 0px 10px 0px\">\r\n                        <div class=\"col-sm-12\">\r\n                            <table id=\"ReplenishmentInfo\">\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div id=\"tab-7\" class=\"tab-pane\">\r\n                    <div class=\"panel-body\" style=\"padding: 10px 0px 10px 0px\">\r\n                        <div class=\"col-sm-12\">\r\n                            <table id=\"AmountReceivable\">\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n</body>\r\n</html>\r\n"
}