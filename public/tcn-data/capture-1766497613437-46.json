{
  "url": "https://os.ourvend.com/SaleDetail/Index",
  "status": 200,
  "contentType": "text/html; charset=utf-8",
  "body": "\r\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n    <meta charset=\"utf-8\">\r\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\r\n    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no\" />\r\n    <title></title>\r\n    <link href=\"../../Content/style.min.css\" rel=\"stylesheet\" />\r\n    <link href=\"../../Content/animate.min.css\" rel=\"stylesheet\" />\r\n    <link type=\"text/css\" href=\"../../Content/bootstrap/css/bootstrap.min.css\" rel=\"Stylesheet\" />\r\n    <link type=\"text/css\" href=\"../../Content/jqGridBootstrap/css/ui.jqgrid-bootstrap.css\" rel=\"Stylesheet\" />\r\n    <link href=\"../../Content/layer/skin/layer.css\" rel=\"stylesheet\" />\r\n    <script src=\"../../Content/MyJS.js\" type=\"text/javascript\"></script>\r\n    <style>\r\n        .font-weight\r\n        {\r\n            font-weight: normal;\r\n        }\r\n\r\n        .ui-jqgrid-hbox\r\n        {\r\n            padding-right: 0px !important;\r\n        }\r\n    </style>\r\n    <script type=\"text/javascript\" src=\"../../Content/bootstrap/js/jquery-1.9.1.js\"></script>\r\n    <script type=\"text/javascript\" src=\"../../Content/bootstrap/js/bootstrap.min.js\"></script>\r\n    <script type=\"text/javascript\" src=\"../../Content/jqGridBootstrap/js/i18n/grid.locale-en.js\"></script>\r\n    <script type=\"text/javascript\" src=\"../../Content/jqGridBootstrap/js/jquery.jqGrid.min.js\"></script>\r\n    <script type=\"text/javascript\" src=\"../../Content/Scripts/JqueryToTableData.js\">\"></script>\r\n    <script type=\"text/javascript\" src=\"../../Content/Scripts/JsonTOCsv.js?t=33\"></script>\r\n    <script type=\"text/javascript\" src=\"/Content/Scripts/My97DatePicker/WdatePicker.js\"></script>\r\n    <script type=\"text/javascript\" src=\"../../Content/layer/layer.js\"></script>\r\n   \r\n <script type=\"text/javascript\">\r\n     var i = 0;\r\n     var Mid = \"\";\r\n     var Table_index = [\"Sequence Numbers\", \"Machine group name\", \"Machine ID\", \"Machine name \", \"Machine body ID\", \"Sales amount\", \"Sales quantity\", \"Amount under failed give-out\", \"Quantity under failed give-out\", \"Amount of  payments\", \"Change amount\", \"Administrator\"];\r\n     var Table_index1 = [\"Sequence Numbers\", \"Machine ID\", \"Machine name \", \"Machine body ID\", \"Sales amount\", \"Sales quantity\", \"Amount under failed give-out\", \"Quantity under failed give-out\", \"Amount of  payments\", \"Change amount\", \"Administrator\"];\r\n     var Table_indexs = [\"Sequence Numbers\", \"Payment type\", \"Sales amount\", \"Sales quantity\", \"Amount under failed give-out\", \"Quantity under failed give-out\", \"Amount of  payments\", \"Change amount\"];\r\n\r\n\r\n     function SetupGrid(grid) {\r\n\r\n         grid.jqGrid({\r\n             url: \"/SaleDetail/MachineListJsoin\",\r\n             styleUI: \"Bootstrap\",\r\n             datatype: \"json\",\r\n             mtype: \"post\",\r\n             postData: { \"MiGroup\": $(\"#MiGroup\").val(), \"MachineID\": $(\"#MachineID\").val(), \"StartDate\": $(\"#StartDate\").val(), \"EndDate\": $(\"#EndDate\").val(), \"boxId\": $(\"#BoxId\").val() },\r\n             colNames: [\"MId\", \"Machine group name\", \"Machine ID\", \"Machine name \", \"Machine body ID\", \"Sales amount\", \"Sales quantity\", \"Amount under failed give-out\", \"Quantity under failed give-out\", \"Amount of  payments\", \"Change amount\", \"Administrator\"], // \r\n             colModel: [\r\n                 { name: \"MachineID\", index: \"MachineID\", width: 1, hidden: true, key: true },\r\n                 { name: \"MGroupName\", index: \"MGroupName\", align: \"center\", sortable: true, hidden: false, frozen: true },\r\n                 { name: \"MachineID\", index: \"MachineID\", align: \"center\", sortable: true, hidden: false, frozen: true },\r\n                 { name: \"MachineName\", index: \"MachineName\", align: \"center\", sortable: true, hidden: false, frozen: true },\r\n                 { name: \"BoxId\", index: \"BoxId\", align: \"center\", sortable: false, hidden: false, frozen: true },\r\n                 { name: \"TotalAmount\", index: \"TotalAmount\", align: \"center\", sortable: true, hidden: false, formatter: ActionFormatter1 },\r\n                 { name: \"TotalCount\", index: \"TotalCount\", align: \"center\", sortable: true, hidden: false },\r\n                 { name: \"TrAmount\", index: \"TrAmount\", align: \"center\", sortable: true, hidden: false, formatter: ActionFormatter1 },\r\n                 { name: \"TrCount\", index: \"TrCount\", align: \"center\", sortable: true, hidden: false },\r\n                 { name: \"Collect\", index: \"Collect\", align: \"center\", sortable: true, hidden: false, formatter: ConvertCollect },\r\n                 { name: \"Change\", index: \"Change\", align: \"center\", sortable: true, hidden: false, formatter: ConvertCollect },\r\n                 { name: \"UserName\", index: \"UserName\", align: \"center\", sortable: true, hidden: false }\r\n             ],\r\n             sortname: \"UserName\",\r\n             sortorder: \"asc\",\r\n             multiselect: false,\r\n             multiboxonly: false,\r\n             width: document.body.clientWidth - 50,\r\n             rowNum: 10,\r\n             rowList: [10, 20, 50, 100, 200, 500],\r\n             height: window.screen.height * 0.19,\r\n             shrinkToFit: false,\r\n             rownumbers: true,\r\n             pager: \"#pager\",\r\n             caption: \"Vending machine\",\r\n             rownumbers: true,\r\n             ondblClickRow: function (id) {\r\n                 if (id != null) {\r\n                     Mid = id;\r\n                     ShowEditor(Mid);\r\n                 }\r\n             }\r\n         });\r\n     }\r\n     /********************************************/\r\n     function SetupAmountGrid(grid) {\r\n         grid.jqGrid({\r\n             url: \"/SaleDetail/AmountListJson\",\r\n             styleUI: \"Bootstrap\",\r\n             datatype: \"json\",\r\n             mtype: \"post\",\r\n             postData: { \"MiGroup\": $(\"#MiGroup\").val(), \"MachineID\": $(\"#MachineID\").val(), \"StartDate\": $(\"#StartDate\").val(), \"EndDate\": $(\"#EndDate\").val(), \"boxId\": $(\"#BoxId\").val() },\r\n             colNames: [\"Payment type\", \"Sales amount\", \"Sales quantity\", \"Amount under failed give-out\", \"Quantity under failed give-out\", \"Amount of  payments\", \"Change amount\"],\r\n             colModel: [\r\n                 { name: \"PayID\", index: \"PayID\", align: \"center\", sortable: true, hidden: false, frozen: true, formatter: TrPayType },\r\n                 { name: \"TotalAmount\", index: \"TotalAmount\", align: \"center\", sortable: true, hidden: false, frozen: true, formatter: ActionFormatter1 },\r\n                 { name: \"TotalCount\", index: \"TotalCount\", align: \"center\", sortable: true, hidden: false, frozen: true },\r\n                 { name: \"TrAmount\", index: \"TrAmount\", align: \"center\", sortable: true, hidden: false, frozen: true, formatter: ActionFormatter1 },\r\n                 { name: \"TrCount\", index: \"TrCount\", align: \"center\", sortable: true, hidden: false, frozen: true },\r\n                 { name: \"Collect\", index: \"Collect\", align: \"center\", sortable: true, hidden: false, frozen: true, formatter: ActionFormatter1 },\r\n                 { name: \"Change\", index: \"Change\", align: \"center\", sortable: true, hidden: false, frozen: true, formatter: ActionFormatter1 },\r\n             ],\r\n             sortname: \"PayID\",\r\n             sortorder: \"asc\",\r\n             multiselect: false,\r\n             multiboxonly: false,\r\n             width: document.body.clientWidth - 50,\r\n             rownumbers: true,\r\n             caption: \"\",\r\n             height: window.screen.height * 0.19,\r\n             caption: \"Payment method\",\r\n             shrinkToFit: false,\r\n             footerrow: true,\r\n             gridComplete: function () {\r\n                 var rowNum = parseInt($(this).getGridParam(\"records\"), 10);\r\n                 if (rowNum > 0) {\r\n                     $(\".ui-jqgrid-sdiv\").show();\r\n                     var id = jQuery(this).getCol(\"PayID\", false);\r\n                     var TotalAmount = jQuery(this).getCol(\"TotalAmount\", false, \"sum\").toFixed(2);\r\n                     var TotalCount = jQuery(this).getCol(\"TotalCount\", false, \"sum\");\r\n                     var TrAmount = jQuery(this).getCol(\"TrAmount\", false, \"sum\").toFixed(2);\r\n                     var TrCount = jQuery(this).getCol(\"TrCount\", false, \"sum\");\r\n                     var Collect = jQuery(this).getCol(\"Collect\", false, \"sum\").toFixed(2);\r\n                     var Change = jQuery(this).getCol(\"Change\", false, \"sum\").toFixed(2);\r\n\r\n                     $(this).footerData(\"set\", {\r\n                         PayID: \"Total\", TotalAmount: TotalAmount, TotalCount: TotalCount,\r\n                         TrAmount: TrAmount, TrCount: TrCount, Collect: Collect, Change: Change\r\n                     });\r\n                 } else {\r\n                     $(\".ui-jqgrid-sdiv\").hide();\r\n                 }\r\n             },\r\n             userDataOnFooter: true,\r\n         });\r\n     }\r\n\r\n     /*******************************************/\r\n\r\n     //自定义货机故障格式\r\n     function IsFaultFormatter(cellvalue, options, rowdata) {\r\n         if (cellvalue == \"1\")\r\n             return \"Normal\"; //正常\r\n         else if (cellvalue == \"4\")\r\n             return \"Error\";\r\n         else if (cellvalue == null)\r\n             return \"\";\r\n     }\r\n     function addCellAttr(rowId, val, rawObject, cm, rdata) {\r\n         if (val == \"Error\")\r\n             return \"style=\\\"background-color:#FDFF72\\\"\";\r\n         else if (val == \"Out of stock\")\r\n             return \"style=\\\"background-color:#FF784E\\\"\";\r\n     }\r\n     function ActionFormatter1(cellvalue, options, rowObject) {\r\n         if (cellvalue == null) {\r\n             return 0;\r\n\r\n         } else {\r\n             cellvalue = cellvalue / 1;\r\n             return cellvalue.toFixed(2);\r\n         }\r\n     }\r\n     function ActionFormatter2(num, options, rowObject) {\r\n         var s = \"0\";\r\n         if (num == null) {\r\n             num = \"\";\r\n         }\r\n         else {\r\n             num = num.toString().replace(/\\$|\\,/g, \"\");\r\n             if (isNaN(num))\r\n                 num = \"0\";\r\n             sign = (num == (num = Math.abs(num)));\r\n             num = Math.floor(num * 100 + 0.50000000001);\r\n             cents = num % 100;\r\n             num = Math.floor(num / 100).toString();\r\n             if (cents < 10)\r\n                 cents = \"0\" + cents;\r\n             for (var i = 0; i < Math.floor((num.length - (1 + i)) / 3); i++)\r\n                 num = num.substring(0, num.length - (4 * i + 3)) + \",\" +\r\n                     num.substring(num.length - (4 * i + 3));\r\n             s = (((sign) ? \"\" : \"-\") + num + \".\" + cents);\r\n         }\r\n         return s;\r\n         return num;\r\n     }\r\n\r\n     function ConvertCollect(collectValue, options, rowObject) {\r\n         return parseFloat(collectValue).toFixed(2);\r\n     }\r\n\r\n     function PayTypeFormatter(cellvalue, options, rowdata) {\r\n         switch (cellvalue) {\r\n             case \"现金\":\r\n                 return \"Pay by cash \";\r\n             case \"银联卡\":\r\n                 return \"UnionPay card\";\r\n             case \"会员卡\":\r\n                 return \"Membership card\";\r\n             case \"0\":\r\n                 return \"Pay by cash \";\r\n             case \"1\":\r\n                 return \"Pay with Union Pay cards\";\r\n             case \"2\":\r\n                 return \"Pay by membership card \";\r\n             case \"4\":\r\n                 return \"Membership Card 1 Payment\";\r\n             case \"5\":\r\n                 return \"Pay with Union Pay cards\" + \"1\";\r\n             case \"11\":\r\n                 return \"WeChat payment\";\r\n             case \"12\":\r\n                 return \"Alipay face-to-face pay\";\r\n             case \"13\":\r\n                 return \"Alipay QR Pay\";\r\n             case \"15\":\r\n                 return \"Gift \";\r\n             case \"16\":\r\n                 return \"One Key\";\r\n             case \"17\":\r\n                 return \"Payment with pick-up code \";\r\n             case \"65\":\r\n                 return \"WeChat payment\" + \"(H)\";\r\n             case \"66\":\r\n                 return \"Alipay QR Pay\" + \"(H)\";\r\n             case \"67\":\r\n                 return \"JD.COM\" + \"(H)\";\r\n             case \"68\":\r\n                 return \"WeChat games (One yuan for luck)\";\r\n             case \"69\":\r\n                 return \"Bestpay\";\r\n             case \"70\":\r\n                 return \"ICBC QR code payment\";\r\n             case \"71\":\r\n                 return \"WeChat membership card\";\r\n             case \"72\":\r\n                 return \"QQ wallet\";\r\n             case \"73\":\r\n                 return \"Unionpay business\";\r\n             case \"74\":\r\n                 return \"PingAn E e-payment\";\r\n             case \"75\":\r\n                 return \"WeChat pay by face recognition\";\r\n             case \"76\":\r\n                 return \"Alipay face recognition payment\";\r\n             case \"77\":\r\n                 return \"Jd aggregate payment\";\r\n             case \"79\":\r\n                 return \"Lichu Payment\";\r\n             case \"89\":\r\n                 return \"AlipayNFC\";\r\n             case \"90\":\r\n                 return \"Hubtel Pay\";\r\n             case \"92\":\r\n                 return \"Midtrans Pay\";\r\n             case \"93\":\r\n                 return \"Paycools Pay\";\r\n             case \"94\":\r\n                 return \"KHQR Pay\";\r\n             case \"101\":\r\n                 return \"Remote Shipment\";\r\n             case \"255\":\r\n                 return \"Other Payments\";//其他支付\r\n             default:\r\n                 return cellvalue;\r\n         }\r\n     }\r\n     var count = 0;\r\n     function ShowEditor(ID) {\r\n         $.post(\"/OperateMonitor/getSession\", \"\", function (data) {\r\n             if (data == \"True\") {\r\n                 loadmodel(ID);\r\n                 layer.open({\r\n                     type: 1,\r\n                     moveType: 1,\r\n                     area: [\"98%\", \"98%\"],\r\n                     content: $(\"#WatchDetail\"),\r\n                     title: \"Sales details\" + \"The time in the machine means the time when the machine dispensed the product; uploading time means the time when the data was uploaded to the machine. There can be a difference between these two times as the first ones can be inaccurate and there can be delays in the second ones.\",\r\n                     success: function () {\r\n                         if (count == 0) {\r\n                             SetupGridPI($(\"#gridPI\"));//销售汇总\r\n                             SetupGridSaleInfo($(\"#gridSaleInfo\"));//出货记录\r\n                             SetupGridSI($(\"#gridIS\"));//交易流水\r\n                             SetupGridMR(ID);\r\n                             SetupDoorStatusInfo($(\"#DoorStatusInfo\"));//门开关流水\r\n                             SetupReplenishmentInfo($(\"#ReplenishmentInfo\"));//补货记录\r\n                             AmountReceivable($(\"#AmountReceivable\")); //应收金额\r\n                         } else {\r\n                             $(\"#gridIS\").jqGrid(\"setGridParam\", { datatype: \"json\", postData: { \"MId\": Mid, \"StartDate\": $(\"#StartDate\").val(), \"EndDate\": $(\"#EndDate\").val() } }).trigger(\"reloadGrid\");\r\n                             $(\"#gridSaleInfo\").jqGrid(\"setGridParam\", { datatype: \"json\", postData: { \"MId\": Mid, \"StartDate\": $(\"#StartDate\").val(), \"EndDate\": $(\"#EndDate\").val() } }).trigger(\"reloadGrid\");\r\n                             $(\"#gridPI\").jqGrid(\"setGridParam\", { datatype: \"json\", postData: { \"MId\": Mid, \"StartDate\": $(\"#StartDate\").val(), \"EndDate\": $(\"#EndDate\").val() } }).trigger(\"reloadGrid\");\r\n                             $(\"#DoorStatusInfo\").jqGrid(\"setGridParam\", { datatype: \"json\", postData: { \"MId\": Mid, \"StartDate\": $(\"#StartDate\").val(), \"EndDate\": $(\"#EndDate\").val() } }).trigger(\"reloadGrid\");\r\n                             $(\"#ReplenishmentInfo\").jqGrid(\"setGridParam\", { datatype: \"json\", postData: { \"MId\": Mid, \"StartDate\": $(\"#StartDate\").val(), \"EndDate\": $(\"#EndDate\").val() } }).trigger(\"reloadGrid\");\r\n                             $(\"#AmountReceivable\").jqGrid(\"setGridParam\", { datatype: \"json\", postData: { \"MId\": Mid, \"StartDate\": $(\"#StartDate\").val(), \"EndDate\": $(\"#EndDate\").val() } }).trigger(\"reloadGrid\");\r\n                         }\r\n                         count++;\r\n                     }\r\n                 });\r\n             } else {\r\n                 window.parent.getSessInfo();\r\n             }\r\n         });\r\n     }\r\n     //出货记录\r\n     function SetupGridSaleInfo(grid, pager) {\r\n         grid.jqGrid({\r\n             url: \"/SaleMonitor/SaleInfoJson/?firstload=0\",\r\n             //colNames: [\"TrID\",\"货道号\",\"支付方式\",\"商品名称\",\"单价\", \"出货结果\",\"时间\"], // \r\n             datatype: \"json\",\r\n             styleUI: \"Bootstrap\",\r\n             mtype: \"POST\",\r\n             postData: { \"MId\": Mid, \"StartDate\": $(\"#StartDate\").val(), \"EndDate\": $(\"#EndDate\").val() },\r\n             colNames: [\"TrID\", \"Slot\", \"Payment type\", \"Product name\", \"Unit price\", \"Result\", \"Time\", \"Server time\"],\r\n             colModel: [\r\n                 { name: \"TrID\", index: \"TrID\", width: 1, hidden: true, key: true },\r\n                 { name: \"TrCoilID\", index: \"TrCoilID\", align: \"center\", sortable: false, hidden: false },\r\n                 { name: \"TrPayType\", index: \"TrPayType\", align: \"center\", sortable: false, hidden: false, formatter: TrPayType },\r\n                 { name: \"PrName\", index: \"PrName\", align: \"center\", sortable: false, hidden: false },\r\n                 { name: \"TrSalePrice\", index: \"TrSalePrice\", align: \"center\", sortable: false, hidden: false, formatter: ActionFormatter1 },\r\n                 { name: \"TrResult\", index: \"TrResult\", align: \"center\", sortable: false, hidden: false, formatter: TrResult },\r\n                 { name: \"TrTime\", index: \"TrTime\", width: \"150\", align: \"center\", sortable: true, formatter: \"date\", formatoptions: { newformat: \"m-d H:i:s\" } },\r\n                 { name: \"AddTime\", index: \"AddTime\", width: \"150\", align: \"center\", sortable: true }\r\n             ],\r\n             shrinkToFit: false,\r\n             sortname: \"TrID\",\r\n             sortorder: \"asc\",\r\n             width: $(this).parent().width(),\r\n             caption: \"\",\r\n             height: 300, //200,\r\n             rowNum: 2000,\r\n         });\r\n     }\r\n     //销售汇总\r\n     function SetupGridPI(grid, pager) {\r\n         grid.jqGrid({\r\n             url: \"/SaleMonitor/ProductSaleInfoJson\",\r\n             datatype: \"json\",\r\n             styleUI: \"Bootstrap\",\r\n             mtype: \"POST\",\r\n             postData: { \"MId\": Mid, \"StartDate\": $(\"#StartDate\").val(), EndDate: $(\"#EndDate\").val() },\r\n             colNames: [\"TrBarCode\", \"Product name\", \"Sales amount\", \"Sales quantity\"], // \r\n             colModel: [\r\n                 { name: \"TrBarCode\", index: \"TrBarCode\", width: 1, hidden: true, key: true },\r\n                 { name: \"PrName\", index: \"PrName\", align: \"center\", sortable: false, hidden: false },\r\n                 { name: \"SaleAmonut\", index: \"SaleAmonut\", align: \"center\", sortable: false, hidden: false, formatter: ActionFormatter1 },\r\n                 { name: \"SaleNum\", index: \"SaleNum\", align: \"center\", sortable: false, hidden: false },\r\n             ],\r\n             shrinkToFit: false,\r\n             sortname: \"TrBarCode\",\r\n             sortorder: \"asc\",\r\n             width: $(this).parent().width(),\r\n             caption: \"\",\r\n             height: 300, //200,\r\n             rowNum: 100,\r\n         });\r\n     }\r\n     //门开关流水\r\n     function SetupDoorStatusInfo(grid, pager) {\r\n         grid.jqGrid({\r\n             url: \"/SaleMonitor/DoorStatusJson\",\r\n             datatype: \"json\",\r\n             styleUI: \"Bootstrap\",\r\n             mtype: \"POST\",\r\n             postData: { \"MId\": Mid, \"StartDate\": $(\"#StartDate\").val(), EndDate: $(\"#EndDate\").val() },\r\n             colNames: [\"Machine ID\", \"Machine name \", \"Status\", \"Time\"],\r\n                colModel: [\r\n                            { name: \"MachineID\", index: \"MachineID\", align: \"center\", hidden: false, key: true },\r\n                            { name: \"MachineName\", index: \"MachineName\", align: \"center\", sortable: false, hidden: false},\r\n                            {\r\n                                name: \"DoorStatus\", index: \"DoorStatus\", align: \"center\", sortable: false, hidden: false, formatter: function (cellvalue, options, rowObject) {\r\n                                    return cellvalue != 0 ? \"Open\" : \"Close\";\r\n                                }\r\n                            },\r\n                            { name: \"Time\", index: \"Time\", width: \"150\", align: \"center\", sortable: true }\r\n                ],\r\n                shrinkToFit: false,\r\n                sortname: \"Time\",\r\n                sortorder: \"desc\",\r\n                width: $(this).parent().width(),\r\n                caption: \"\",\r\n                height: 300, //200,\r\n                rowNum: 2000,\r\n            });\r\n                        }\r\n                        //补货记录\r\n                        function SetupReplenishmentInfo(grid, pager) {\r\n                            grid.jqGrid({\r\n                                url: \"/SaleMonitor/ReplenishmentJson\",\r\n                datatype: \"json\",\r\n                styleUI: \"Bootstrap\",\r\n                mtype: \"POST\",\r\n                postData: { \"MId\": Mid, \"StartDate\": $(\"#StartDate\").val(), EndDate: $(\"#EndDate\").val() },\r\n                colNames: [\"MachineID\", \"Product name\", \"Quantity replenished\", \"Time\"],\r\n                colModel: [\r\n                            { name: \"MachineID\", index: \"MachineID\", align: \"center\", hidden: true, key: true },\r\n                            {\r\n                                name: \"PrName\", index: \"PrName\", align: \"center\", sortable: false, hidden: false, formatter: function (cellvalue, options, rowObject) {\r\n                                    return cellvalue != null ? cellvalue : \"Other\";\r\n                                }\r\n                            },\r\n                            {\r\n                                name: \"Capacity\", index: \"Capacity\", align: \"center\", sortable: false, hidden: false, formatter: function (cellvalue, options, rowObject) {\r\n                                    return cellvalue != null ? cellvalue : 0;\r\n                                }\r\n                            },\r\n                            { name: \"Time\", index: \"Time\", width: \"150\", align: \"center\", sortable: true, formatter: \"date\", formatoptions: { newformat: \"Y-m-d\" } }\r\n                ],\r\n                shrinkToFit: false,\r\n                sortname: \"Time\",\r\n                sortorder: \"desc\",\r\n                width: $(this).parent().width(),\r\n                caption: \"\",\r\n                height: 300, //200,\r\n                rowNum: 2000,\r\n            });\r\n        }\r\n\r\n        ///应收金额\r\n        function AmountReceivable(grid) {\r\n            grid.jqGrid({\r\n                url: \"/SaleMonitor/AmountReceivable\",\r\n                datatype: \"json\",\r\n                styleUI: \"Bootstrap\",\r\n                mtype: \"POST\",\r\n                postData: { \"MId\": Mid, \"StartDate\": $(\"#StartDate\").val(), EndDate: $(\"#EndDate\").val() },\r\n                colNames: [\"MachineID\", \"Amount receivable\", \"Creation time\", \"End time\"],\r\n                colModel: [\r\n                            { name: \"MachineID\", index: \"MachineID\", align: \"center\", hidden: true, key: true },\r\n                            { name: \"Amount\", index: \"Amount\", align: \"center\", sortable: false, hidden: false, formatter: ActionFormatter1 },\r\n                            { name: \"StateTime\", index: \"StateTime\", align: \"center\", sortable: false, hidden: false },\r\n                            { name: \"EndTime\", index: \"EndTime\", width: \"150\", align: \"center\", sortable: false, hidden: false }\r\n                ],\r\n                shrinkToFit: false,\r\n                sortname: \"EndTime\",\r\n                sortorder: \"desc\",\r\n                width: $(this).parent().width(),\r\n                caption: \"\",\r\n                height: 300, //200,\r\n                rowNum: 2000,\r\n            });\r\n        }\r\n\r\n        function ActionFormatter1SI(cellvalue, options, rowObject) {\r\n            var str = rowObject.SiID;\r\n            if (cellvalue == null) {\r\n                cellvalue = \"\";\r\n            }\r\n            var s = cellvalue;\r\n            return s;\r\n        }\r\n        function TrPayType(cellvalue, options, rowdata) {\r\n            switch (cellvalue / 1) {\r\n                case 0:\r\n                    return \"Pay by cash \";\r\n                case 1:\r\n                    return \"Pay with Union Pay cards\";\r\n                case 2:\r\n                    return \"Pay by membership card \";\r\n                case 4:\r\n                    return \"Membership Card 1 Payment\";\r\n                case 5:\r\n                    return \"Pay with Union Pay cards\" + \"1\";\r\n                case 11:\r\n                    return \"WeChat payment\";\r\n                case 12:\r\n                    return \"Alipay face-to-face pay\";\r\n                case 13:\r\n                    return \"Alipay QR Pay\";\r\n                case 15:\r\n                    return \"Gift \";\r\n                case 16:\r\n                    return \"One Key\";\r\n                case 17:\r\n                    return \"Payment with pick-up code \";\r\n                case 65:\r\n                    return \"WeChat payment\" + \"(H)\";\r\n                case 66:\r\n                    return \"Alipay QR Pay\" + \"(H)\";\r\n                case 67:\r\n                    return \"JD.COM\" + \"(H)\";\r\n                case 68:\r\n                    return \"WeChat games (One yuan for luck)\";\r\n                case 69:\r\n                    return \"Bestpay\";\r\n                case 70:\r\n                    return \"ICBC QR code payment\";\r\n                case 71:\r\n                    return \"WeChat membership card\";\r\n                case 72:\r\n                    return \"Qpay\";\r\n                case 73:\r\n                    return \"Unionpay business\";\r\n                case 74:\r\n                    return \"PingAn E e-payment\";\r\n                case 75:\r\n                    return \"WeChat pay by face recognition\";\r\n                case 76:\r\n                    return \"Alipay face recognition payment\";\r\n                case 77:\r\n                    return \"Jd aggregate payment\";\r\n                case 79:\r\n                    return \"Lichu Payment\";\r\n                case 89:\r\n                    return \"AlipayNFC\";\r\n                case 90:\r\n                    return \"Hubtel Pay\";\r\n                case 92:\r\n                    return \"Midtrans Pay\";\r\n                case 93:\r\n                    return \"Paycools Pay\";\r\n                case 94:\r\n                    return \"KHQR Pay\";\r\n                case 101:\r\n                    return \"Remote Shipment\";\r\n                case 255:\r\n                    return \" Other Payments\";//其他支付\r\n                default:\r\n                    return cellvalue;\r\n            }\r\n        }\r\n        function TrResult(cellvalue, options, rowdata) {\r\n            if (cellvalue == \"0\")\r\n                return \"Normal\"; //正常\r\n            else\r\n                return \"Error\";\r\n        }\r\n        function PayTypeMr(cellvalue, options, rowdata) {\r\n            if (cellvalue == \"1\")\r\n                return \"Coin-operated\"; //\"投币\"\r\n    else if (cellvalue == \"2\")\r\n        return \"Return coin\"; //\"退币\"\r\n            else if (cellvalue == null)\r\n                return \"\";\r\n    }\r\n    function TypeMr(cellvalue, options, rowdata) {\r\n        if (cellvalue == \"1\")\r\n            return \"Note\"; //\"纸币\"\r\n        else if (cellvalue == \"2\")\r\n            return \"Coin\"; //\"硬币\"\r\n        else if (cellvalue == null)\r\n            return \"\";\r\n}\r\nfunction ActionFormatter1MR(cellvalue, options, rowObject) {\r\n    var str = rowObject.SiID;\r\n    if (cellvalue == null) {\r\n        cellvalue = \"\";\r\n    }\r\n    var s = cellvalue;\r\n    return s;\r\n}\r\n//交易流水Table[0]\r\nfunction SetupGridSI(grid, pager) {\r\n    grid.jqGrid({\r\n        url: \"/SaleMonitor/OutJson/\",\r\n            //            colNames: [\"ID\", \"货道号\", \"商品名称\", \"支付类型\", \"价格\", \"结果\", \"时间\"], // ViewData[\"paySign\"]\r\n            datatype: \"json\",\r\n            styleUI: \"Bootstrap\",\r\n            mtype: \"POST\",\r\n            postData: { MId: Mid, StartDate: $(\"#StartDate\").val(), EndDate: $(\"#EndDate\").val() },\r\n        colNames: [\"ID\", \"Slot\", \"Product name\", \"Payment type\", \"Unit price\", \"Result\", \"Time\", \"Server time\"], //\r\n            colModel: [\r\n                            { name: \"TrID\", index: \"TrID\", width: 1, hidden: true, key: true },\r\n                            { name: \"TrCoilID\", index: \"TrCoilID\", align: \"center\", width: \"80\", sortable: false, hidden: false, formatter: ActionFormatter1SI },\r\n                            { name: \"PrName\", index: \"PrName\", align: \"center\", sortable: false, hidden: false, formatter: ActionFormatter1SI },\r\n                            { name: \"TrPayType\", index: \"TrPayType\", align: \"center\", width: \"80\", sortable: false, hidden: false, formatter: TrPayType },\r\n                            { name: \"TrSalePrice\", index: \"TrSalePrice\", align: \"center\", width: \"80\", sortable: false, hidden: false, formatter: ActionFormatter1 },\r\n                            { name: \"TrResult\", index: \"TrResult\", align: \"center\", width: \"60\", sortable: false, hidden: false, formatter: TrResult },\r\n                            { name: \"TrTime\", index: \"TrTime\", width: \"100\", align: \"center\", sortable: true, formatter: \"date\", formatoptions: { newformat: \"Y-m-d H:i:s\" } },\r\n                            { name: \"AddTime\", index: \"AddTime\", width: \"100\", align: \"center\", sortable: true }\r\n            ],\r\n            shrinkToFit: false,\r\n            sortname: \"AddTime\",\r\n            sortorder: \"desc\",\r\n            width: $(this).parent().width(),\r\n            height: 300, //200,\"auto\"\r\n            rowNum: 2000,\r\n            onCellSelect: function (rowid) {\r\n                var data = $(\"#\" + rowid + \">td\");\r\n                $(\"#gridMR\").jqGrid(\"setGridParam\", { postData: { \"ID\": rowid, \"Mid\": Mid, \"Time\": data[7].innerHTML } }).trigger(\"reloadGrid\");\r\n            },\r\n            gridComplete: function () {\r\n                SetupGridMR(\"\");\r\n            }\r\n\r\n        });\r\n    }\r\n    //交易流水Table[1]\r\n    function SetupGridMR(id) {\r\n        $(\"#gridMR\").jqGrid({\r\n            url: \"/SaleMonitor/CashJson/\",\r\n            datatype: \"json\",\r\n            styleUI: \"Bootstrap\",\r\n            mtype: \"POST\",\r\n            colNames: [\"ID\", \"Type\", \"Payment types\", \"Coin-operatedBalance \", \"Amount to be refunded\", \"Amount actually refunded \", \"Time\"], // \r\n                colModel: [\r\n                                { name: \"MrID\", index: \"MrID\", width: 1, hidden: true, key: true },\r\n                                { name: \"MrPayType\", index: \"MrPayType\", align: \"center\", width: \"50\", sortable: false, hidden: false, formatter: PayTypeMr },\r\n                                { name: \"MrType\", index: \"MrType\", align: \"center\", width: \"50\", sortable: false, hidden: false, formatter: TypeMr },\r\n                                { name: \"MrBorrowMoney\", index: \"MrBorrowMoney\", align: \"center\", width: \"100\", sortable: false, hidden: false, formatter: ActionFormatter1 },\r\n                                { name: \"MrLoanMoney\", index: \"MrLoanMoney\", align: \"center\", width: \"100\", sortable: false, hidden: false, formatter: ActionFormatter1 },\r\n                                { name: \"RealPay\", index: \"RealPay\", align: \"center\", width: \"100\", sortable: false, hidden: false, formatter: ActionFormatter1MR },\r\n                                { name: \"MrRecordTime\", index: \"MrRecordTime\", align: \"center\", width: \"150\", sortable: true, formatter: \"date\", formatoptions: { newformat: \"Y-m-d H:i:s\" } },\r\n                ],\r\n                shrinkToFit: false,\r\n                sortname: \"MrID\",\r\n                sortorder: \"desc\",\r\n                width: $(this).parent().width(),\r\n                caption: \"\",\r\n                height: 300,\r\n                rowNum: 2000\r\n        });\r\n\r\n        }\r\n        //加载销售明细\r\n        function loadmodel(id) {\r\n            $.post(\"/SaleMonitor/SaleInfo/\", { PrID: id, StartDate: $(\"#StartDate\").val(), EndDate: $(\"#EndDate\").val() }, function (data) {\r\n                $(\"#MachineIDs\").html(data[\"MId\"]);\r\n                $(\"#Aliase\").html(data[\"MiAlias\"]);\r\n                $(\"#Receipt\").html(data[\"Collect\"]);\r\n                $(\"#ChangeAmount\").html(data[\"Change\"]);\r\n                $(\"#Sale\").html(data[\"SaleAmount\"]);\r\n                $(\"#SaleQty\").html(data[\"SaleQuantity\"]);\r\n                $(\"#DeployAddress\").html(data[\"MiAddress\"]);\r\n\r\n            });\r\n        }\r\n        function Init() {\r\n            $(\"#btnSearch\").click(function () {\r\n                Search();\r\n            });\r\n            $(\"#btnEdit\").click(function () {\r\n                var s = GetSelectedItems();\r\n                if (s != null) {\r\n                    Mid = s;\r\n                    ShowEditor(s);\r\n                }\r\n                else {\r\n                    alert(\"You must choose a record before operation Or double click a record\"); //选中一条记录才能进行操作！\r\n                }\r\n            });\r\n            SetupGrid($(\"#grid\"));\r\n            SetupAmountGrid($(\"#AmountGrid\"));\r\n        }\r\n\r\n        function RefreshGrid() {\r\n            $(\"#grid\").trigger(\"reloadGrid\");\r\n            $(\"#AmountGrid\").trigger(\"reloadGrid\");\r\n        }\r\n\r\n        function Search() {\r\n            $.post(\"/OperateMonitor/getSession\", \"\", function (data) {\r\n                if (data == \"True\") {\r\n                    var indexTime = Date.parse($(\"#StartDate\").val().replace(/-/g, \"/\"));\r\n                    var LastTime = Date.parse($(\"#EndDate\").val().replace(/-/g, \"/\"));\r\n                    if (LastTime < indexTime) {\r\n                        Modal_Message(\"Message Box\", \"Cut-off time\");\r\n                        return;\r\n                    }\r\n                    if (LastTime - indexTime > 6 * 24 * 60 * 60 * 1000) {\r\n                        Modal_Message(\"Message Box\", \"Time interval should not be greater than 7 days!\");\r\n                        return;\r\n                    }\r\n                    if ($(\"#StartDate\").val().split(\"-\")[0] != $(\"#EndDate\").val().split(\"-\")[0]) {\r\n                        Modal_Message(\"Message Box\", \"Time interval is less than 1 Year\");\r\n                        return;\r\n                    }\r\n                    $(\"#grid\").jqGrid(\"setGridParam\", {\r\n                        page: 1, sortname: \"MachineID\", sortorder: \"asc\", postData: {\r\n                            \"MiGroup\": $(\"#MiGroup\").val(), \"MachineID\": $(\"#MachineID\").val(), \"StartDate\": $(\"#StartDate\").val(), \"EndDate\": $(\"#EndDate\").val(), \"boxId\": $(\"#BoxId\").val()\r\n                        }\r\n                    });\r\n                    //SetupAmountGrid($(\"#AmountGrid\"));\r\n                    $(\"#AmountGrid\").jqGrid(\"setGridParam\", { page: 1, sortname: \"PayID\", sortorder: \"asc\", postData: { \"MiGroup\": $(\"#MiGroup\").val(), \"MachineID\": $(\"#MachineID\").val(), \"StartDate\": $(\"#StartDate\").val(), \"EndDate\": $(\"#EndDate\").val(), \"boxId\": $(\"#BoxId\").val() } });\r\n                    RefreshGrid();\r\n                } else {\r\n                    window.parent.getSessInfo();\r\n                }\r\n            });\r\n\r\n\r\n        }\r\n        function GetSelectedItems() {\r\n            return $(\"#grid\").getGridParam(\"selrow\");\r\n        }\r\n\r\n        $(document).ready(function () {\r\n            $(\"body\").height(window.screen.height * 0.81);\r\n            $.post(\"/OperateMonitor/getSession\", \"\", function (data) {\r\n                if (data == \"True\") {\r\n                    Init();\r\n                } else {\r\n                    window.parent.getSessInfo();\r\n                }\r\n            })\r\n\r\n\r\n        });\r\n\r\n        //function ExportExecl() {\r\n            //JsonTOCsv(JqueryDatas(\"AmountGrid\"), Table_indexs, \"Sales details\" + \"(1)\" + Time());\r\n                //var JsonData = [];\r\n                //$(\"#grid tr\").each(function () {\r\n                //    var Data = new Array();\r\n\r\n                //    for (var i = 0; i < $(this).children().length; i++) {\r\n                //        if (i != 1) {\r\n                //            Data[i] = $(this).children().eq(i).text().replace(/\\,/g, \"\");\r\n                //        }\r\n                //    }\r\n                //    JsonData.push(Data);\r\n                //});\r\n\r\n               // JsonTOCsv(JsonData, Table_index, \"Sales details\" + \"(2)\" + Time());\r\n        //}\r\n        \r\n\r\n        //消息框\r\n        function Modal_Message(Title, Message) {\r\n            $(\"#MessageTitle\").html(Title);\r\n            $(\"#MessageContent\").html(Message);\r\n            $(\"#Role_Message\").modal(\"show\");\r\n        }\r\n\r\n\r\n        //开始时间\r\n        function StartDatePicker() {\r\n            WdatePicker({\r\n                minDate: \"2018-05-1\",\r\n                onpicked: function () {\r\n                    var indexTime = Date.parse($(\"#StartDate\").val().replace(/-/g, \"/\"));\r\n                    var LastTime = Date.parse($(\"#EndDate\").val().replace(/-/g, \"/\"));\r\n\r\n                    if (LastTime - indexTime > 6 * 24 * 60 * 60 * 1000) {\r\n                        $(\"#EndDate\").val($(\"#StartDate\").val());\r\n                    }\r\n                    else if (LastTime - indexTime < 0) {\r\n                        $(\"#EndDate\").val($(\"#StartDate\").val());\r\n                    }\r\n                }\r\n            })\r\n        }\r\n        //结束时间\r\n        function EndDate() { \r\n            ApiType = EndDatePicker(0, \"6\", \"StartDate\", \"1\") \r\n        }\r\n\r\n\r\n\r\n        //导出付款方式CSV\r\n        function PTExportExecl() {\r\n            $(\"#PTCheckExportExecl\").modal(\"show\");\r\n        }\r\n         \r\n        //导出付款方式当前页数据到execl\r\n        function PTExportExecl_Part() {\r\n             \r\n            JsonTOCsv(JqueryDatas(\"AmountGrid\"), Table_indexs, \"Sales details-Payment method\" + \"(1)\" + Time());\r\n            $(\"#PTCheckExportExecl\").modal(\"hide\");\r\n        }\r\n        //导出付款方式全部数据到execl\r\n        function PTExportExecl_All() {\r\n            var date = new Date();\r\n            var strdate = date.getFullYear() + \"_\" + (date.getMonth() + 1) + \"_\" + date.getDate();\r\n            //读取数据 \r\n            var exceldata2 = []; \r\n            exceldata2.push(new Array());\r\n            var MiGroup = $(\"#MiGroup\").val() ? $(\"#MiGroup\").val() : \"\";\r\n            var MachineID = $(\"#MachineID\").val() ? $(\"#MachineID\").val() : \"\";\r\n            var StartDate = $(\"#StartDate\").val() ? $(\"#StartDate\").val() : \"\";\r\n            var EndDate = $(\"#EndDate\").val() ? $(\"#EndDate\").val() : \"\";\r\n            var boxId = $(\"#BoxId\").val();\r\n            debugger \r\n            $.post(\"/SaleDetail/Get_AmountList\", \"MiGroup=\" + MiGroup + \"&MachineID=\" + MachineID + \"&StartDate=\" + StartDate + \"&EndDate=\" + EndDate + \"&boxId=\" + boxId+ \"\",\r\n                function (data) {\r\n                    for (var i = 0; i < data.length; i++) {\r\n                        var arr_data2 = new Array();\r\n                        var PayID = data[i].PayID != null ? TrPayType(data[i].PayID) : \"\";\r\n                        arr_data2[0] = i+1;\r\n                        arr_data2[1] = PayID;\r\n                        arr_data2[2] = data[i].TotalAmount;\r\n                        arr_data2[3] = data[i].TotalCount;\r\n                        arr_data2[4] = data[i].TrAmount;\r\n                        arr_data2[5] = data[i].TrCount;\r\n                        arr_data2[6] = data[i].Collect;\r\n                        arr_data2[7] = data[i].Change;\r\n\r\n                        exceldata2.push(arr_data2);\r\n                    }\r\n                    if (exceldata2.length == 1) {\r\n                        alert(\"No data. Please check data first.\");\r\n                    } else {\r\n                        //导出excel\r\n                        JsonTOCsv(exceldata2, Table_indexs, \"Sales details-Payment method\" + \"(1)\" + Time());\r\n                    }\r\n                });\r\n            $(\"#PTCheckExportExecl\").modal(\"hide\");\r\n        }\r\n\r\n\r\n\r\n\r\n        //导出售货机CSV\r\n        function VMExportExecl() {\r\n            $(\"#VMCheckExportExecl\").modal(\"show\");\r\n        }\r\n        //导出售货机当前页数据到execl\r\n        function VMExportExecl_Part() {\r\n\r\n\r\n            JsonTOCsvOne(JqueryData(\"grid\"), Table_index, \"Sales details-Vending machine\" + \"(2)\" + Time());\r\n            $(\"#VMCheckExportExecl\").modal(\"hide\");\r\n        }\r\n\r\n        //导出售货机全部数据到execl\r\n        function VMExportExecl_All() {\r\n            var date = new Date();\r\n            var strdate = date.getFullYear() + \"_\" + (date.getMonth() + 1) + \"_\" + date.getDate();\r\n            //读取数据\r\n            var exceldata = [];\r\n            exceldata.push(new Array());\r\n            var MiGroup = $(\"#MiGroup\").val() ? $(\"#MiGroup\").val() : \"\";\r\n            var MachineID = $(\"#MachineID\").val() ? $(\"#MachineID\").val() : \"\";\r\n            var StartDate = $(\"#StartDate\").val() ? $(\"#StartDate\").val() : \"\";\r\n            var EndDate = $(\"#EndDate\").val() ? $(\"#EndDate\").val() : \"\";\r\n            var boxId = $(\"#BoxId\").val();\r\n            var table_herd = [ \"Machine ID\", \"Machine name \",\"Machine body ID\", \"Sales amount\", \"Sales quantity\", \"Amount under failed give-out\", \"Quantity under failed give-out\", \"Amount of  payments\", \"Change amount\", \"Administrator\"];\r\n         \r\n            $.post(\"/SaleDetail/Get_MachineList\", \"MiGroup=\" + MiGroup + \"&MachineID=\" + MachineID + \"&StartDate=\" + StartDate + \"&EndDate=\" + EndDate + \"&boxId=\" + boxId + \"\",\r\n                function (data) {\r\n                    for (var i = 0; i < data.length; i++) {\r\n                        var arr_data = new Array();\r\n                        arr_data[0] = i + 1;\r\n                        arr_data[1] = data[i].MGName;\r\n                        arr_data[2] = data[i].MachineID;\r\n                        arr_data[3] = data[i].MachineName;\r\n                        arr_data[4] = data[i].boxId;\r\n                        arr_data[5] = data[i].TotalAmount;\r\n                        arr_data[6] = data[i].TotalCount;\r\n                        arr_data[7] = data[i].TrAmount;\r\n                        arr_data[8] = data[i].TrCount;\r\n                        arr_data[9] = data[i].Collect;\r\n                        arr_data[10] = data[i].Change;\r\n                        arr_data[11] = data[i].UserName; \r\n                        exceldata.push(arr_data);\r\n                    }\r\n                    if (exceldata.length == 1) {\r\n                        alert(\"No data. Please check data first.\");\r\n                    } else {\r\n                        //导出excel\r\n                        JsonTOCsvOne(exceldata, Table_index1, \"Sales details-Vending machine\" + \"(2)\" + Time());\r\n                    }\r\n                });\r\n         $(\"#VMCheckExportExecl\").modal(\"hide\");\r\n     }\r\n\r\n\r\n\r\n </script>\r\n    <script type=\"text/javascript\">\r\n\r\n</script>\r\n    <style type=\"text/css\">\r\n        .tab-content table{width:100% !important;}\r\n        ::-webkit-scrollbar{  width:8px;  height:8px;  }  \r\n        /*搜索栏*/\r\n        .ibox-title{min-height: initial;padding: 10px 12px;background: #f9f9f9;}\r\n        .ibox-title:after{content:\"\"; display:block; clear:both; height:0; visibility:hidden;}\r\n        .ibox-title h5{margin: 0;}\r\n        .ibox-content:after{content:\"\"; display:block; clear:both; height:0; visibility:hidden;}\r\n        .ibox-content{ padding: 15px 20px 0 10px; }\r\n        .ibox-content .group-left{ margin-bottom: 15px;}\r\n        .float-e-margins .btn{margin-bottom: 0px;}\r\n        .ibox-content div.input-btton{float: right;margin-bottom: 15px;height: auto; }\r\n        .ibox-content .input-group.group-left label{margin-left: 10px; margin-top: 8px;vertical-align: top;}\r\n    </style>\r\n</head>\r\n<body class=\"fixed-sidebar full-height-layout pace-done\">\r\n    <div class=\"col-xs-12 col-md-12\" style=\"background-color: #f5f5f5; font-size: 14px;\">\r\n        <div class=\"col-xs-12 col-sm-12 col-md-6\" style=\"top: 4px;\"><span class=\"glyphicon glyphicon-home\">&nbspHome&nbsp</span>&gt<span>&nbspHistory&nbsp</span>&gt<span>&nbspSales details&nbsp</span></div>\r\n        <div class=\"col-xs-12 col-sm-12 col-md-6\" style=\"text-align: right;\"><a href=\"javascript:location.reload();\" class=\"btn btn-success btn\"><span class=\"glyphicon glyphicon-refresh\"></span></a></div>\r\n    </div>\r\n    <div style=\"height:18px;\"></div>\r\n    <div class=\"wrapper wrapper-content animated fadeInRight\">\r\n        <div class=\"ibox float-e-margins bordercss\">\r\n            \r\n            <div class=\"ibox-content\">\r\n                \r\n<link href=\"../../Content/bootstrap/css/bootstrap-select.min.css\" rel=\"stylesheet\" />\r\n<script src=\"../../Content/bootstrap/js/bootstrap-select.min.js\"></script>\r\n<script type=\"text/javascript\">\r\n    $(document).ready(function () {\r\n        getGroup();\r\n        $(\"#MiGroup\").change(function () { getMachineID($(this).val()); });\r\n        $('#MiGroup,#MachineID').selectpicker({\r\n            width:140,\r\n            size: 4,\r\n        });\r\n        $('.selectpicker').selectpicker('refresh');\r\n        $(\"#MachineID\").on('shown.bs.select',\r\n            function (e) {\r\n                console.log('展开之后');\r\n                $('#MachineID').prev().find(\"input\").keyup(function () {\r\n                    document.getElementById(\"MachineID\").options.selectedIndex = 0; //回到初始状态\r\n                    $(\"#MachineID\").selectpicker('refresh');//对searchPayState这个下拉框进行重置刷新\r\n                    $('#MachineID').prev().find(\"input\").attr('id', \"deviceInput\"); //为input增加id属性\r\n                    console.log($('#deviceInput').val()); //获取输入框值输出到控制台\r\n                    deviceInput = $('#deviceInput').val()\r\n                    $('#MachineID').parent().find('button').children()[0].innerHTML = deviceInput\r\n                    //console.log(deviceInput)\r\n                })\r\n            })\r\n\r\n    });\r\n    //绑定组下拉框\r\n    function getGroup() {\r\n        $.ajax({\r\n            url: '/AssetsManage/GetStringMachineGroup',\r\n            type: \"post\",\r\n            datatype: \"json\",\r\n            success: function (data1) {\r\n                var Html = \"<option value=''>--Please choose--</option>\";\r\n                    var data = JSON.parse(data1);\r\n                    for (var i = 0; i < data.length; i++) {\r\n                        Html += \"<option value='\" + data[i].MGID + \"'>\" + data[i].MGName + \"</option>\";\r\n                    }\r\n                    $(\"#MiGroup\").html(Html);\r\n                $(\"#MiGroup\").selectpicker('refresh');\r\n                }\r\n        });\r\n    };\r\n    //获取机器IDselectpicker\r\n    function getMachineID(id) {\r\n        $.ajax({\r\n            url: '/SaleSummarize/GetMachineID',\r\n             type: \"post\",\r\n             datatype: \"json\",\r\n             data: { \"MachineGroup\": id },\r\n            success: function (data) {\r\n                console.log(data)\r\n                 var Html = \"<option value=''>--Please choose--</option>\";\r\n                    for (var i = 0; i < data.length; i++) {\r\n                        Html += \"<option value='\" + data[i].MuMachineID + \"'>\" + data[i].MiAlias + \"</option>\";\r\n                    }\r\n                    $(\"#MachineID\").html(Html);\r\n                $(\"#MachineID\").selectpicker('refresh');\r\n                //console.log($(\".MachineID\").prev().find('.bs-searchbox').find('input'))\r\n                }\r\n         });\r\n    }\r\n</script>\r\n<div class=\"input-group group-left\">\r\n    <label style=\"margin-top: 8px\">Machine grouping：</label>\r\n</div>\r\n<div class=\"input-group group-left\">\r\n    <div class=\"form-group\" style=\"margin-bottom:0px\">\r\n        <select class=\"selectpicker\" data-live-search=\"true\" data-size=\"10\" id=\"MiGroup\"></select>\r\n    </div>\r\n</div>\r\n<div class=\"input-group group-left\">\r\n    <label style=\"margin-left: 10px; margin-top: 8px\">Machine ID：</label>\r\n</div>\r\n<div class=\"input-group group-left\">\r\n    <div class=\"form-group\" style=\"margin-bottom:0px\">\r\n        <select class=\"selectpicker\" data-live-search=\"true\" data-size=\"10\" id=\"MachineID\">\r\n            <option value=''>--Please choose--</option>\r\n        </select>\r\n    </div>\r\n</div>\r\n\r\n                <div class=\"input-group group-left\">\r\n                    <label>Start date：</label>\r\n                    <div class=\"input-group-btn\"></div>\r\n                    <input type=\"text\" style=\"width: 100px;\" class=\"form-control\" id=\"StartDate\" name=\"StartDate\" onclick=\"StartDatePicker()\" value=\"2025-12-23\" />\r\n                </div>\r\n                <div class=\"input-group group-left\">\r\n                    <label>End date：</label>\r\n                    <div class=\"input-group-btn\"></div>\r\n                    <input type=\"text\" class=\"form-control\" style=\"width: 100px;\" id=\"EndDate\" name=\"EndDate\" onclick=\"EndDate()\" value=\"2025-12-23\" />\r\n                </div>\r\n                 <div class=\"input-group group-left\">\r\n                    <label>Currently only queries within 7 days from the start time are supported</label>\r\n                </div>\r\n                 <div class=\"input-group group-left\">\r\n                    <label style=\"float:left\">Machine body ID：</label>\r\n                     <input type=\"text\" class=\"form-control\" style=\"width: 200px;\" id=\"BoxId\" placeholder=\"Please enter the box number\" autocomplete=\"off\"/>\r\n                </div>\r\n                 <div class=\"input-btton\">\r\n                    <input  type=\"button\" style=\"margin-right: 10px\" class=\"btn btn-w-m btn-primary right\"\r\n                        onclick=\"VMExportExecl()\" value=\"Export vending machine\" />\r\n                    <input  type=\"button\" style=\"margin-right: 10px\" class=\"btn btn-w-m btn-primary right\"\r\n                        onclick=\"PTExportExecl()\" value=\"Export payment method\" />\r\n                    <input id=\"btnEdit\" type=\"button\" style=\"margin-right: 10px\" class=\"btn btn-w-m btn-primary right\" value=\"Query details\" />\r\n                    <input id=\"btnSearch\" type=\"button\"style=\"margin-right: 10px\" class=\"btn btn-w-m btn-primary right\" value=\"Query\" />\r\n                    \r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class=\"ibox float-e-margins\">\r\n            <div class=\"ibox-content\" style=\"padding: 0px\">\r\n                <table id=\"AmountGrid\" class=\"scroll\">\r\n                </table>\r\n                <table id=\"grid\" class=\"scroll\">\r\n                </table>\r\n                <div id=\"pager\">\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n\r\n    \r\n\r\n    <div id=\"WatchDetail\" style=\"display: none\">\r\n        <div class=\"ibox float-e-margins bordercss\">\r\n            <div class=\"ibox-content\" style=\"padding: 10px\">\r\n                <div class=\"row\" style=\"margin-left: 0px; margin-right: 0px\">\r\n                    <div class=\"col-sm-3\">\r\n                        <label class=\"col-sm-6\">Machine ID</label>\r\n                        <label class=\"col-sm-6 font-weight\" id=\"MachineIDs\"></label>\r\n                        <input type=\"hidden\" id=\"Mid\" value=\"\" />\r\n                    </div>\r\n                    <div class=\"col-sm-3\">\r\n                        <label class=\"col-sm-6\">Machine name </label>\r\n                        <label class=\"col-sm-6 font-weight\" id=\"Aliase\"></label>\r\n                    </div>\r\n                    <div class=\"col-sm-3\">\r\n                        <label class=\"col-sm-6\">Amount of  payments</label>\r\n                        <label class=\"col-sm-6 font-weight\" id=\"Receipt\"></label>\r\n                    </div>\r\n                    <div class=\"col-sm-3\">\r\n                        <label class=\"col-sm-6\">Change amount</label>\r\n                        <label class=\"col-sm-6 font-weight\" id=\"ChangeAmount\"></label>\r\n                    </div>\r\n                </div>\r\n                <div class=\"row\" style=\"margin-left: 0px; margin-right: 0px\">\r\n                    <div class=\"col-sm-3\">\r\n                        <label class=\"col-sm-6\">Sales amount</label>\r\n                        <label class=\"col-sm-6 font-weight\" id=\"Sale\"></label>\r\n                    </div>\r\n                    <div class=\"col-sm-3\">\r\n                        <label class=\"col-sm-6\">Sales quantity</label>\r\n                        <label class=\"col-sm-6 font-weight\" id=\"SaleQty\"></label>\r\n                    </div>\r\n                    <div class=\"col-sm-3\">\r\n                        <label class=\"col-sm-6\">Deployment address</label>\r\n                        <label class=\"col-sm-6 font-weight\" id=\"DeployAddress\"></label>\r\n                    </div>\r\n                    <div class=\"col-sm-3\">\r\n                        <label class=\"col-sm-6\">Administrator</label>\r\n                        <label class=\"col-sm-6 font-weight\" id=\"Controller\"></label>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class=\"tabs-container\" style=\"padding: 5px\">\r\n            <ul class=\"nav nav-tabs\">\r\n                <li class=\"active\"><a data-toggle=\"tab\" href=\"#tab-1\" aria-expanded=\"true\">Trading Flow</a>\r\n                </li>\r\n                <li class=\"\"><a data-toggle=\"tab\" href=\"#tab-2\" aria-expanded=\"false\">Sales summary</a>\r\n                </li>\r\n                <li class=\"\"><a data-toggle=\"tab\" href=\"#tab-3\" aria-expanded=\"false\">Card swiping record</a>\r\n                </li>\r\n                <li class=\"\"><a data-toggle=\"tab\" href=\"#tab-4\" aria-expanded=\"false\">Give-out record</a>\r\n                </li>\r\n                <li class=\"\"><a data-toggle=\"tab\" href=\"#tab-5\" aria-expanded=\"false\">Door opening/closing record</a>\r\n                </li>\r\n                <li class=\"\"><a data-toggle=\"tab\" href=\"#tab-6\" aria-expanded=\"false\">Replenishment record</a>\r\n                </li>\r\n                <li class=\"\"><a data-toggle=\"tab\" href=\"#tab-7\" aria-expanded=\"false\">Amount receivable</a>\r\n                </li>\r\n            </ul>\r\n            <div class=\"tab-content\">\r\n                <div id=\"tab-1\" class=\"tab-pane active\">\r\n                    <div class=\"panel-body\" style=\"padding: 10px 0px 10px 0px\">\r\n                        <div class=\"col-sm-6\">\r\n                            <table id=\"gridIS\">\r\n                            </table>\r\n                        </div>\r\n                        <div class=\"col-sm-6\">\r\n                            <table id=\"gridMR\">\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div id=\"tab-2\" class=\"tab-pane\">\r\n                    <div class=\"panel-body\" style=\"padding: 10px 0px 10px 0px\">\r\n                        <div class=\"col-sm-12\">\r\n                            <table id=\"gridPI\">\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div id=\"tab-3\" class=\"tab-pane\">\r\n                    <div class=\"panel-body\" style=\"height: 350px; padding: 10px 0px 10px 0px\">\r\n                        <strong>No data found currently</strong>\r\n                        <p></p>\r\n                    </div>\r\n                </div>\r\n                <div id=\"tab-4\" class=\"tab-pane\">\r\n                    <div class=\"panel-body\" style=\"padding: 10px 0px 10px 0px\">\r\n                        <div class=\"col-sm-12\">\r\n                            <table id=\"gridSaleInfo\">\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div id=\"tab-5\" class=\"tab-pane\">\r\n                    <div class=\"panel-body\" style=\"padding: 10px 0px 10px 0px\">\r\n                        <div class=\"col-sm-12\">\r\n                            <table id=\"DoorStatusInfo\">\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div id=\"tab-6\" class=\"tab-pane\">\r\n                    <div class=\"panel-body\" style=\"padding: 10px 0px 10px 0px\">\r\n                        <div class=\"col-sm-12\">\r\n                            <table id=\"ReplenishmentInfo\">\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div id=\"tab-7\" class=\"tab-pane\">\r\n                    <div class=\"panel-body\" style=\"padding: 10px 0px 10px 0px\">\r\n                        <div class=\"col-sm-12\">\r\n                            <table id=\"AmountReceivable\">\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    \r\n    <div class=\"modal fade\" id=\"PTCheckExportExecl\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"myModalLabel\" aria-hidden=\"true\">\r\n        <div class=\"modal-dialog\" role=\"document\" style=\"width: 359px; height: 165px\">\r\n            <div class=\"modal-content\">\r\n                <div class=\"modal-header\">\r\n                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-hidden=\"true\">\r\n                        &times;\r\n                    </button>\r\n                    <h4 class=\"modal-title\">ExportPayment method</h4>\r\n                </div>\r\n                <div class=\"modal-body\" style=\"text-align: center;\">\r\n                    <button type=\"button\" class=\"btn btn-default\" onclick=\"PTExportExecl_Part()\" style=\"margin-right: 10px;\" data-toggle=\"modal\" data-target=\"#myModal\">Export the data in current page</button>\r\n                    <button type=\"button\" class=\"btn btn-default\" onclick=\"PTExportExecl_All()\" data-toggle=\"modal\" data-target=\"#myModal\">Export all data</button>\r\n                </div>\r\n                <div class=\"modal-footer\"></div>\r\n            </div>\r\n            <!-- /.modal-content -->\r\n        </div>\r\n        <!-- /.modal -->\r\n    </div>\r\n\r\n    \r\n    \r\n    <div class=\"modal fade\" id=\"VMCheckExportExecl\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"myModalLabel\" aria-hidden=\"true\">\r\n        <div class=\"modal-dialog\" role=\"document\" style=\"width: 359px; height: 165px\">\r\n            <div class=\"modal-content\">\r\n                <div class=\"modal-header\">\r\n                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-hidden=\"true\">\r\n                        &times;\r\n                    </button>\r\n                    <h4 class=\"modal-title\">ExportVending machine</h4>\r\n                </div>\r\n                <div class=\"modal-body\" style=\"text-align: center;\">\r\n                    <button type=\"button\" class=\"btn btn-default\" onclick=\"VMExportExecl_Part()\" style=\"margin-right: 10px;\" data-toggle=\"modal\" data-target=\"#myModal\">Export the data in current page</button>\r\n                    <button type=\"button\" class=\"btn btn-default\" onclick=\"VMExportExecl_All()\" data-toggle=\"modal\" data-target=\"#myModal\">Export all data</button>\r\n                </div>\r\n                <div class=\"modal-footer\"></div>\r\n            </div>\r\n            <!-- /.modal-content -->\r\n        </div>\r\n        <!-- /.modal -->\r\n    </div>\r\n\r\n\r\n    <div class=\"modal fade\" id=\"Role_Message\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"myModalLabel\" aria-hidden=\"true\">\r\n        <div class=\"modal-dialog\" id=\"Div2\">\r\n            <div class=\"modal-content\">\r\n                <div class=\"modal-header\">\r\n                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-hidden=\"true\">\r\n                        &times;\r\n                    </button>\r\n                    <h4 class=\"modal-title\" id=\"MessageTitle\"></h4>\r\n                </div>\r\n                <div class=\"modal-body\" id=\"MessageContent\">\r\n                </div>\r\n                <div class=\"modal-footer\">\r\n                    <button type=\"button\" class=\"btn btn-success\" data-dismiss=\"modal\">\r\n                        Submit\r\n                    </button>\r\n                </div>\r\n            </div>\r\n            <!-- /.modal-content -->\r\n        </div>\r\n        <!-- /.modal -->\r\n    </div>\r\n</body>\r\n</html>\r\n         </div>\r\n            <!-- /.modal-content -->\r\n        </div>\r\n        <!-- /.modal -->\r\n    </div>\r\n</body>\r\n</html>\r\n"
}